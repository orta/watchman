<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>trigger | Watchman</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="trigger" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The trigger command will create or replace a trigger." />
<meta property="og:description" content="The trigger command will create or replace a trigger." />
<link rel="canonical" href="https://facebook.github.io/watchman/docs/cmd/trigger.html" />
<meta property="og:url" content="https://facebook.github.io/watchman/docs/cmd/trigger.html" />
<meta property="og:site_name" content="Watchman" />
<meta property="og:image" content="https://facebook.github.io/watchman/static/og_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-03T15:40:25+00:00" />
<script type="application/ld+json">
{"headline":"trigger","url":"https://facebook.github.io/watchman/docs/cmd/trigger.html","dateModified":"2020-12-03T15:40:25+00:00","datePublished":"2020-12-03T15:40:25+00:00","description":"The trigger command will create or replace a trigger.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://facebook.github.io/watchman/static/logo.png"}},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://facebook.github.io/watchman/docs/cmd/trigger.html"},"image":"https://facebook.github.io/watchman/static/og_image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" type="text/css" media="screen" href="/watchman/css/main.css">
  <link rel="icon" href="static/favicon.png" type="image/x-icon">

  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.min.js"></script>
  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>

  
  <link type="application/atom+xml" rel="alternate" href="https://facebook.github.io/watchman/feed.xml" title="Watchman" />
</head>

  <body>    
    <div id="fixed_header" class="fixedHeaderContainer visible">
  <header>
    <a href="https://facebook.github.io/watchman/"><img src="/watchman/static/logo.png" /><h2>Watchman</h2></a>
    <div class="navigationWrapper navigationFull" id="flat_nav">
      <nav class="navigation">
        <ul>
          
          <li class="navItem navItemActive">
            <a href=/watchman/docs/install.html>Docs</a>
          </li>
          
          <li class="navItem ">
            <a href=/watchman/support.html>Support</a>
          </li>
          
          <li class="navItem ">
            <a href=http://github.com/facebook/watchman>GitHub</a>
          </li>
          
        </ul>
      </nav>
    </div>
    <div class="navigationWrapper navigationSlider" id="navigation_wrap"></div>
  </header>
  <script>
    var event = document.createEvent('Event');
    event.initEvent('slide', true, true);
    document.addEventListener('slide', function (e) {
      document.body.classList.toggle('sliderActive');
    }, false);
    var navData = [
      
      {
        href       : "/watchman/docs/install.html",
        text       : "Docs",
      },
      
      {
        href       : "/watchman/support.html",
        text       : "Support",
      },
      
      {
        href       : "http://github.com/facebook/watchman",
        text       : "GitHub",
      },
      
    ];
  </script>
  <script type="text/javascript">  
  window.addEventListener('load', function() {
    var Nav = React.createClass({displayName: "Nav",
      getInitialState: function() {
        return {
          currentPath: window.location.pathname,
          slideoutActive: false,
        };
      },
      getDefaultProps: function() {
        return {
          data: navData,
        }
      },
      handleClick: function(id) {
        this.setState({
          slideoutActive: false,
        });
        document.dispatchEvent(event);
      },
      handleSlide: function(id) {
        this.setState({
          slideoutActive: !this.state.slideoutActive,
        });
        document.dispatchEvent(event);
      },
      render: function() {
        var classes = React.addons.classSet({
          'navSlideout': true,
          'navSlideoutActive': this.state.slideoutActive,
        });
        var navClasses = React.addons.classSet({
          'slidingNav': true,
          'slidingNavActive': this.state.slideoutActive,
        });
        return (
          React.createElement("div", null, 
            React.createElement("div", {className: classes, onClick: this.handleSlide}, 
              React.createElement("i", {className: "fa fa-bars"})
            ), 
            React.createElement("nav", {className: navClasses}, 
              React.createElement("ul", null, 
                this.props.data.map(this.renderNavItems)
              )
            )
          )
        );
      },
      renderNavItems: function(child, index) {
        var classes = React.addons.classSet({
          'navItem': true,
          'navItemActive': this.state.currentPath === child.href,
        });
        return (
          React.createElement("li", {key: index, className: classes}, 
            React.createElement("a", {onClick: this.handleClick, href: child.href}, child.text)
          )
        );
      },
    });

    function render(navData) {
      React.render(
        React.createElement(Nav, {data: navData}),
        document.getElementById('navigation_wrap')
      );
    }
    render(navData);
  });
  </script>
</div>

    <div class="navPusher">
      <div class="mainContainer blogContainer postContainer">
  <div id="main_wrap" class="wrapper mainWrapper">
    <div>
</div>
<nav class='toc' id="doc_nav"></nav>
<script>
  var docnavData = [
    
    {
      group     : "Installation",
      items     : [
        
          
        {
          key : "/watchman/docs/install.html",
          title : "Installation",
          url : "/watchman/docs/install.html",
        },
        
          
        {
          key : "/watchman/docs/release-notes.html",
          title : "Release Notes",
          url : "/watchman/docs/release-notes.html",
        }
        
      ],
    },
    
    {
      group     : "Invocation",
      items     : [
        
          
        {
          key : "/watchman/docs/cli-options.html",
          title : "Command Line",
          url : "/watchman/docs/cli-options.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-make.html",
          title : "watchman-make",
          url : "/watchman/docs/watchman-make.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-wait.html",
          title : "watchman-wait",
          url : "/watchman/docs/watchman-wait.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-replicate-subscription.html",
          title : "watchman-replicate-subscription",
          url : "/watchman/docs/watchman-replicate-subscription.html",
        },
        
          
        {
          key : "/watchman/docs/cppclient.html",
          title : "C++ Client",
          url : "/watchman/docs/cppclient.html",
        },
        
          
        {
          key : "/watchman/docs/nodejs.html",
          title : "NodeJS",
          url : "/watchman/docs/nodejs.html",
        },
        
          
        {
          key : "/watchman/docs/config.html",
          title : "Configuration Files",
          url : "/watchman/docs/config.html",
        },
        
          
        {
          key : "/watchman/docs/socket-interface.html",
          title : "Socket Interface",
          url : "/watchman/docs/socket-interface.html",
        }
        
      ],
    },
    
    {
      group     : "Compatibility",
      items     : [
        
          
        {
          key : "/watchman/docs/compatibility.html",
          title : "Compatibility Rules",
          url : "/watchman/docs/compatibility.html",
        },
        
          
        {
          key : "/watchman/docs/capabilities.html",
          title : "Capabilities",
          url : "/watchman/docs/capabilities.html",
        }
        
      ],
    },
    
    {
      group     : "Commands",
      items     : [
        
          
        {
          key : "/watchman/docs/cmd/clock.html",
          title : "clock",
          url : "/watchman/docs/cmd/clock.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/find.html",
          title : "find",
          url : "/watchman/docs/cmd/find.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/flush-subscriptions.html",
          title : "flush-subscriptions",
          url : "/watchman/docs/cmd/flush-subscriptions.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-config.html",
          title : "get-config",
          url : "/watchman/docs/cmd/get-config.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-sockname.html",
          title : "get-sockname",
          url : "/watchman/docs/cmd/get-sockname.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/list-capabilities.html",
          title : "list-capabilities",
          url : "/watchman/docs/cmd/list-capabilities.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log.html",
          title : "log",
          url : "/watchman/docs/cmd/log.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log-level.html",
          title : "log-level",
          url : "/watchman/docs/cmd/log-level.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/query.html",
          title : "query",
          url : "/watchman/docs/cmd/query.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/shutdown-server.html",
          title : "shutdown-server",
          url : "/watchman/docs/cmd/shutdown-server.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/since.html",
          title : "since",
          url : "/watchman/docs/cmd/since.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-enter.html",
          title : "state-enter",
          url : "/watchman/docs/cmd/state-enter.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-leave.html",
          title : "state-leave",
          url : "/watchman/docs/cmd/state-leave.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/subscribe.html",
          title : "subscribe",
          url : "/watchman/docs/cmd/subscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger.html",
          title : "trigger",
          url : "/watchman/docs/cmd/trigger.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-del.html",
          title : "trigger-del",
          url : "/watchman/docs/cmd/trigger-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-list.html",
          title : "trigger-list",
          url : "/watchman/docs/cmd/trigger-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/unsubscribe.html",
          title : "unsubscribe",
          url : "/watchman/docs/cmd/unsubscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/version.html",
          title : "version",
          url : "/watchman/docs/cmd/version.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch.html",
          title : "watch",
          url : "/watchman/docs/cmd/watch.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del.html",
          title : "watch-del",
          url : "/watchman/docs/cmd/watch-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del-all.html",
          title : "watch-del-all",
          url : "/watchman/docs/cmd/watch-del-all.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-list.html",
          title : "watch-list",
          url : "/watchman/docs/cmd/watch-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-project.html",
          title : "watch-project",
          url : "/watchman/docs/cmd/watch-project.html",
        }
        
      ],
    },
    
    {
      group     : "Queries",
      items     : [
        
          
        {
          key : "/watchman/docs/clockspec.html",
          title : "Clockspec",
          url : "/watchman/docs/clockspec.html",
        },
        
          
        {
          key : "/watchman/docs/file-query.html",
          title : "File Queries",
          url : "/watchman/docs/file-query.html",
        },
        
          
        {
          key : "/watchman/docs/simple-query.html",
          title : "Simple Pattern Syntax",
          url : "/watchman/docs/simple-query.html",
        },
        
          
        {
          key : "/watchman/docs/scm-query.html",
          title : "Source Control Aware Queries",
          url : "/watchman/docs/scm-query.html",
        }
        
      ],
    },
    
    {
      group     : "Expression Terms",
      items     : [
        
          
        {
          key : "/watchman/docs/expr/allof.html",
          title : "allof",
          url : "/watchman/docs/expr/allof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/anyof.html",
          title : "anyof",
          url : "/watchman/docs/expr/anyof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/dirname.html",
          title : "dirname & idirname",
          url : "/watchman/docs/expr/dirname.html",
        },
        
          
        {
          key : "/watchman/docs/expr/empty.html",
          title : "empty",
          url : "/watchman/docs/expr/empty.html",
        },
        
          
        {
          key : "/watchman/docs/expr/exists.html",
          title : "exists",
          url : "/watchman/docs/expr/exists.html",
        },
        
          
        {
          key : "/watchman/docs/expr/match.html",
          title : "match & imatch",
          url : "/watchman/docs/expr/match.html",
        },
        
          
        {
          key : "/watchman/docs/expr/name.html",
          title : "name & iname",
          url : "/watchman/docs/expr/name.html",
        },
        
          
        {
          key : "/watchman/docs/expr/not.html",
          title : "not",
          url : "/watchman/docs/expr/not.html",
        },
        
          
        {
          key : "/watchman/docs/expr/pcre.html",
          title : "pcre & ipcre",
          url : "/watchman/docs/expr/pcre.html",
        },
        
          
        {
          key : "/watchman/docs/expr/since.html",
          title : "since",
          url : "/watchman/docs/expr/since.html",
        },
        
          
        {
          key : "/watchman/docs/expr/size.html",
          title : "size",
          url : "/watchman/docs/expr/size.html",
        },
        
          
        {
          key : "/watchman/docs/expr/suffix.html",
          title : "suffix",
          url : "/watchman/docs/expr/suffix.html",
        },
        
          
        {
          key : "/watchman/docs/expr/type.html",
          title : "type",
          url : "/watchman/docs/expr/type.html",
        }
        
      ],
    },
    
    {
      group     : "Internals",
      items     : [
        
          
        {
          key : "/watchman/docs/bser.html",
          title : "BSER Binary Protocol",
          url : "/watchman/docs/bser.html",
        },
        
          
        {
          key : "/watchman/docs/casefolding.html",
          title : "Case-Insensitivity",
          url : "/watchman/docs/casefolding.html",
        },
        
          
        {
          key : "/watchman/contributing.html",
          title : "Contributing",
          url : "/watchman/contributing.html",
        },
        
          
        {
          key : "/watchman/docs/cookies.html",
          title : "Query Synchronization",
          url : "/watchman/docs/cookies.html",
        }
        
      ],
    },
    
    {
      group     : "Troubleshooting",
      items     : [
        
          
        {
          key : "/watchman/docs/troubleshooting.html",
          title : "Troubleshooting",
          url : "/watchman/docs/troubleshooting.html",
        }
        
      ],
    },
    
  ];
</script>
<script type="text/javascript">
window.addEventListener('load', function() {
  var DocNav = React.createClass({displayName: "DocNav",
    getInitialState: function() {
      return {
        toggleActive: false,
      };
    },
    getDefaultProps: function() {
      return {
        currentDoc: "trigger",
        currentGroup: "Commands",
        data: docnavData,
      }
    },
    handleSlide: function(id) {
      this.setState({
        toggleActive: !this.state.toggleActive,
      });
    },
    render: function() {
      var classes = React.addons.classSet({
        'navToggle': true,
        'navToggleActive': this.state.toggleActive,
      });
      var navClasses = React.addons.classSet({
        'toggleNav': true,
        'toggleNavActive': this.state.toggleActive,
      });
      return (
        React.createElement("div", {className: navClasses},
          React.createElement("section", null,
            this.props.data.map(this.renderNavGroups)
          ),
          React.createElement("div", {className: classes, onClick: this.handleSlide}, React.createElement("i", {className: "fa fa-chevron-circle-down"}))
        )
      );
    },
    renderNavGroups: function(child, index) {
      var classes = React.addons.classSet({
        'navGroup': true,
        'navGroupActive': this.props.currentGroup === child.group,
      });
      return (
        React.createElement("div", {className: classes, key: index},
          React.createElement("h3", null, child.group),
          React.createElement("ul", null,
            child.items.map(this.renderNavItems)
          )
        )
      );
    },
    renderNavItems: function(child, index) {
      var itemClasses = React.addons.classSet({
        'navListItem': true,
        'navListItemActive': this.props.currentDoc === child.title,
      });
      var classes = React.addons.classSet({
        'navItem': true,
        'navItemActive': this.props.currentDoc === child.title,
      });
      return (
        React.createElement("li", {className: itemClasses, key: index}, React.createElement("a", {className: classes, href: child.url},  child.title))
      );
    },
  });

  function docNavRender(docnavData) {
    React.render(
      React.createElement(DocNav, {data: docnavData}),
      document.getElementById('doc_nav')
    );
  }
  docNavRender(docnavData);
});
</script>

    <div class="post">
  <header class="post-header">
    <h1 class="post-title">trigger</h1>
  </header>

  <article class="post-content">
   
      <p>The trigger command will create or replace a trigger.</p>

<p>A trigger is a saved incremental query over a watched root.  When files
change that match the query expression, Watchman will spawn a process and
pass information about the changed files to it.</p>

<p>Triggered processes are spawned by the Watchman server process that runs in
the background; they do not have access to your terminal and their
output is redirected (by default) to the Watchman log file.</p>

<p>Watchman waits for the filesystem to settle before processing any
triggers, batching the list of changed files together before invoking
the registered command.  You can adjust the settle period via the
<code class="language-plaintext highlighter-rouge">.watchmanconfig</code> file.</p>

<p>Note that deleted files are counted as changed files and are passed the command
in exactly the same way as changed-but-existing files.</p>

<p>Watchman will only run a single instance of the trigger process at a time.
That avoids fork-bomb style behavior in cases where your trigger also modifies
files.  When the process terminates, watchman will re-evaluate the trigger
criteria based on the clock at the time the process was last spawned; if
a file list is generated watchman will spawn a new child with the files
that changed in the meantime.</p>

<p>Unless <code class="language-plaintext highlighter-rouge">no-save-state</code> is in use, triggers are saved and re-established
across a Watchman process restart.  If you had triggeres saved prior to
upgrading to Watchman 2.9.7, those triggers will be forgotten as you upgrade
past version 2.9.7; you will need to re-register them.</p>

<p>There are two syntaxes for registering triggers; a simple syntax that allows
very simple trigger configuration with some reasonable defaults, and a second
extended syntax which is available since Watchman version 2.9.7.</p>

<p>The simple syntax is implemented in terms of the extended syntax and is
preserved for backwards compatibility with older clients.</p>

<h3 id="extended-syntax">Extended syntax</h3>

<p><em>Since 2.9.7.</em></p>

<p>You may use the extended JSON trigger definition syntax detailed below.  It
provides more control over how the triggered commands are invoked than was
possible in earlier versions.</p>

<p>JSON:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="s2">"trigger"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/path/to/dir"</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;triggerobj&gt;</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Where <code class="language-plaintext highlighter-rouge">triggerobj</code> is a trigger configuration object with the fields
defined below.</p>

<p>Here’s an example trigger specified via the CLI that will cause <code class="language-plaintext highlighter-rouge">make</code> to
be run whenever assets or sources are changed:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">-j</span> <span class="o">&lt;&lt;-</span><span class="no">EOT</span><span class="sh">
["trigger", "/path/to/root", {
  "name": "assets",
  "expression": ["pcre", "</span><span class="se">\.</span><span class="sh">(js|css|c|cpp)</span><span class="nv">$"</span><span class="sh">],
  "command": ["make"]
}]
</span><span class="no">EOT
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>The possible trigger object properties are:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">name</code> defines the name of the trigger.  You may use this name to
remove the trigger later.  Registering a different trigger with the same name
as an existing trigger will implicitly delete the old trigger and then
register the new one, causing the trigger expression to be evaluated for the
whole tree.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">command</code> specifies the command to invoke.  It must be an array of string
values; this will form the argv array of the trigger process.  When
the trigger is spawned, the <code class="language-plaintext highlighter-rouge">$PATH</code> of the Watchman process will be used
to locate the command.  If you have changed your <code class="language-plaintext highlighter-rouge">$PATH</code> since the Watchman
process was started, Watchman won’t be able to see your new <code class="language-plaintext highlighter-rouge">$PATH</code>.
If you are registering trigger that runs something from an unusual or
non-default location, it is recommended that you specify the full path
to that command.  If you are registering a trigger script that can
be found in the watched root, just specify the path relative to the
root.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">append_files</code> is an optional boolean parameter; if enabled, the <code class="language-plaintext highlighter-rouge">command</code>
array will have the set of matching file names appended when the trigger
is invoked.  System limits such as <code class="language-plaintext highlighter-rouge">sysconf(_SC_ARG_MAX)</code>
and/or <code class="language-plaintext highlighter-rouge">RLIMIT_STACK</code> set an upper bound on the size of the parameters
and environment that are passed to a spawned process.  Watchman will
try to ensure that the command is runnable by keeping the number of
file name arguments below the system limits.  If the full set cannot be
passed to the process, Watchman will pass as many as it thinks will fit and
omit the rest.  When this argument list truncation occurs, Watchman will
export <code class="language-plaintext highlighter-rouge">WATCHMAN_FILES_OVERFLOW=true</code> into the environment so that the child
process can determine that this has happened.  Watchman cannot break
the arguments apart and run multiple processes for each argument batch;
for that functionality, use <code class="language-plaintext highlighter-rouge">xargs(1)</code> for the <code class="language-plaintext highlighter-rouge">command</code> and set the
<code class="language-plaintext highlighter-rouge">stdin</code> property to <code class="language-plaintext highlighter-rouge">NAME_PER_LINE</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">expression</code> accepts a query expression.  The expression is applied
to the list of changed files to generate the set of files that are
relevant to this trigger.  If no files match, the command will not be
invoked.  Omitting the expression will match all changed files.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">stdin</code> specifies how stdin should be configured for the command
invocation.  You may set the value of this property to one of the following:</p>

    <ul>
      <li>
        <p>the string value <code class="language-plaintext highlighter-rouge">/dev/null</code> - sets stdin to read from <code class="language-plaintext highlighter-rouge">/dev/null</code>.
This is the default and will be used if you omit the <code class="language-plaintext highlighter-rouge">stdin</code> property.</p>
      </li>
      <li>
        <p>an array value will be interpreted as a list of field names.  When
the command is invoked, Watchman will generate an array of JSON objects
that contain those field names on stdin.  For example, if <code class="language-plaintext highlighter-rouge">stdin</code> is set
to <code class="language-plaintext highlighter-rouge">["name", "size"]</code>, stdin will be a JSON array containing the list
of changed files, represented as objects with the <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">size</code>
properties: <code class="language-plaintext highlighter-rouge">[{"name": "filename.txt", "size": 123}]</code>.
The list of valid fields is the same as the same as that
documented in the <code class="language-plaintext highlighter-rouge">query</code> command.  Just as with the <code class="language-plaintext highlighter-rouge">query</code> command,
if the field list is comprised of a single field then the JSON
will be an array of those field values.  For instance, if you set
<code class="language-plaintext highlighter-rouge">stdin</code> to <code class="language-plaintext highlighter-rouge">["name"]</code> the JSON will be of the form <code class="language-plaintext highlighter-rouge">["filename.txt"]</code>
instead of <code class="language-plaintext highlighter-rouge">[{"name": "filename.txt"}]</code>.</p>
      </li>
      <li>
        <p>the string value <code class="language-plaintext highlighter-rouge">NAME_PER_LINE</code> will cause Watchman to generate a list
of file names on stdin, one name per line.  No quoting will be applied to
the names, and they may contain spaces.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">stdout</code> and <code class="language-plaintext highlighter-rouge">stderr</code> control the output and error streams.  If omitted,
the corresponding stream will be inherited from the Watchman process, which
typically means that the command output/error stream will show up in the
Watchman log file.  If specified, the value must be a string:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">&gt;path/to/file</code> - causes output to redirected to the specified file.
The path is relative to the watched root, and will be truncated
prior to being written to, if it exists, or created if it does not
exist.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">&gt;&gt;path/to/file</code> - causes output to redirected to the specified file.
The path is relative to the watched root.  If the file already exists
then it will be appended to.  The file will be created if it does not
exist.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">max_files_stdin</code> specifies a limit on the number of files reported on
stdin when stdin is set to hold the set of matched files.  If the number of
files that matched exceeds this limit, the input will be truncated to match
this limit and <code class="language-plaintext highlighter-rouge">WATCHMAN_FILES_OVERFLOW=true</code> will also be exported into the
environment.  The default, if omitted, is no limit.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">chdir</code> can be used to specify the working directory that should be set
prior to spawning the process.  The default is to set the working directory
to the watched root.  The value of this property is a string that will be
interpreted relative to the watched root.  Note that changing the working dir
does not cause the file names from the query result to be re-written: they
will <em>always</em> be relative to the watched root.  The path to the root can
be found in the <code class="language-plaintext highlighter-rouge">$WATCHMAN_ROOT</code> environmental variable.</p>
  </li>
</ul>

<h3 id="simple-syntax">Simple syntax</h3>

<p>The simple syntax is easier to execute from the CLI than the JSON based
extended syntax, but doesn’t allow all of the trigger options to be set.
In only supports the <a href="/watchman/docs/simple-query.html">Simple Pattern Syntax</a> for queries.</p>

<p>From the command line:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">--</span> trigger /path/to/dir triggername <span class="o">[</span>patterns] <span class="nt">--</span> <span class="o">[</span>cmd]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note that the first <code class="language-plaintext highlighter-rouge">--</code> is to distinguish watchman CLI switches from the
second <code class="language-plaintext highlighter-rouge">--</code>, which delimits patterns from the trigger command.  This is only
needed when using the CLI, not when using the JSON protocol.</p>

<p>JSON:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="s2">"trigger"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/path/to/dir"</span><span class="p">,</span><span class="w"> </span><span class="s2">"triggername"</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;patterns&gt;</span><span class="p">,</span><span class="w"> </span><span class="s2">"--"</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;cmd&gt;</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">--</span> trigger ~/www jsfiles <span class="s1">'*.js'</span> <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-l</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note the single quotes around the <code class="language-plaintext highlighter-rouge">*.js</code>; if you omit them, your shell
will expand it to a list of file names and register those in the trigger.
While this would work, any <code class="language-plaintext highlighter-rouge">*.js</code> files that you add after registering the
trigger will not cause the trigger to run.</p>

<p>or in JSON:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="s2">"trigger"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/home/wez/www"</span><span class="p">,</span><span class="w"> </span><span class="s2">"jsfiles"</span><span class="p">,</span><span class="w"> </span><span class="s2">"*.js"</span><span class="p">,</span><span class="w"> </span><span class="s2">"--"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-l"</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>The simple syntax is interpreted as a trigger object with the following
settings:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">name</code> is set to the <code class="language-plaintext highlighter-rouge">triggername</code></li>
  <li><code class="language-plaintext highlighter-rouge">command</code> is set to the <code class="language-plaintext highlighter-rouge">&lt;cmd&gt;</code> list</li>
  <li><code class="language-plaintext highlighter-rouge">expression</code> is generated from the <code class="language-plaintext highlighter-rouge">&lt;patterns&gt;</code> list using the rules laid
out in <a href="/watchman/docs/simple-query.html">Simple Pattern Syntax</a></li>
  <li><code class="language-plaintext highlighter-rouge">append_files</code> is set to <code class="language-plaintext highlighter-rouge">true</code></li>
  <li><code class="language-plaintext highlighter-rouge">stdin</code> is set to <code class="language-plaintext highlighter-rouge">["name", "exists", "new", "size", "mode"]</code></li>
  <li><code class="language-plaintext highlighter-rouge">stdout</code> and <code class="language-plaintext highlighter-rouge">stderr</code> will be set to output to the Watchman log file</li>
  <li><code class="language-plaintext highlighter-rouge">max_files_stdin</code> will be left unset</li>
</ul>

<p>For this simple example, if <code class="language-plaintext highlighter-rouge">~/www/scripts/foo.js</code> is changed,
watchman will chdir to <code class="language-plaintext highlighter-rouge">~/www</code> then invoke <code class="language-plaintext highlighter-rouge">ls -l scripts/foo.js</code>.  Note that
the output will show up in the Watchman log file, not in your terminal.</p>

<h3 id="environment-for-trigger-commands">Environment for trigger commands</h3>

<p>Since Watchman version 2.9.7, the following environment variables are set
for all trigger commands, even those registered using the simple trigger
syntax:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">WATCHMAN_FILES_OVERFLOW</code> is set to <code class="language-plaintext highlighter-rouge">true</code> if the number of files exceeds
either the <code class="language-plaintext highlighter-rouge">max_files_stdin</code> limit or the system argument size limit.</li>
  <li><code class="language-plaintext highlighter-rouge">WATCHMAN_CLOCK</code> is set to the current clock at the time of the trigger
invocation</li>
  <li><code class="language-plaintext highlighter-rouge">WATCHMAN_SINCE</code> is set to the clock value of the prior trigger invocation,
or unset if this is the first trigger invocation.</li>
  <li><code class="language-plaintext highlighter-rouge">WATCHMAN_ROOT</code> is set to the path to the watched root</li>
  <li><code class="language-plaintext highlighter-rouge">WATCHMAN_TRIGGER</code> is set to the name of the trigger</li>
  <li><code class="language-plaintext highlighter-rouge">WATCHMAN_SOCK</code> is set to the path to the Watchman socket, so that you
can figure out how to connect back to Watchman.</li>
</ul>

<h3 id="relative-roots">Relative roots</h3>

<p><em>Since 3.4.</em></p>

<p>Watchman supports optionally evaluating triggers with respect to a path within a
watched root. This is used with the <code class="language-plaintext highlighter-rouge">relative_root</code> parameter:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="s2">"trigger"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/path/to/watched/root"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"relative-assets"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"expression"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"pcre"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\.</span><span class="s2">(js|css|c|cpp)$"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"make"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"relative_root"</span><span class="p">:</span><span class="w"> </span><span class="s2">"project1"</span><span class="w">
</span><span class="p">}]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Setting a relative root results in the following modifications to triggers:</p>

<ul>
  <li>Queries are evaluated with respect to the relative root. See
<a href="/watchman/docs/file-query.html">File Queries</a> for more.</li>
  <li>The current directory for triggered processes is set to the relative root,
unless it is changed with <code class="language-plaintext highlighter-rouge">chdir</code>. If <code class="language-plaintext highlighter-rouge">chdir</code> is a relative path then it will
be evaluated with respect to the relative root. So, for the example trigger
above, if <code class="language-plaintext highlighter-rouge">chdir</code> is <code class="language-plaintext highlighter-rouge">"subdir2"</code>, the current directory for triggered <code class="language-plaintext highlighter-rouge">make</code>
invocations is <code class="language-plaintext highlighter-rouge">/path/to/watched/root/project1/subdir2</code>.</li>
  <li>In the environment, <code class="language-plaintext highlighter-rouge">WATCHMAN_ROOT</code> is still set to the actual root.</li>
  <li><code class="language-plaintext highlighter-rouge">WATCHMAN_RELATIVE_ROOT</code> is set to the full path of the relative root.</li>
</ul>

<p>Relative roots behave similarly to a separate Watchman watch on the
subdirectory, without any of the system overhead that that imposes. This is
useful for large repositories, where your script or tool is only interested in a
particular directory inside the repository.</p>

    
  </article>
</div>

  </div>
</div>


      <div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <section id="fb_oss" class="fbOpenSourceFooter">
      <a href="https://code.facebook.com/projects/" target="_blank"><img src="/watchman/static/oss_logo.png" alt="Facebook Open Source" title="Facebook Open Source" /></a>
    </section>
  </div>
</div>
<script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = window.location.href.replace(window.location.hash, '') + "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  window.addEventListener('load', function() {
    var contentBlock = document.getElementsByClassName("post")[0] || document.getElementsByClassName("news")[0];
    if (!contentBlock) {
      return;
    }
    for (var level = 1; level <= 6; level++) {
      linkifyAnchors(level, contentBlock);
    }
  });
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44373548-13', 'auto');
  ga('send', 'pageview');
</script>
<script>
  window.addEventListener('load', function() {
    hljs.initHighlightingOnLoad();

    // Async load some styles
    function loadStyle(href) {
      var s = document.createElement('link');
      s.setAttribute('rel', 'stylesheet');
      s.setAttribute('href', href);
      s.setAttribute('type', 'text/css');
      document.getElementsByTagName('head')[0].appendChild(s);
    }
    loadStyle("//nuclide.io/static/fonts/332720/BC699FA675F9356E3.css");
    loadStyle("//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css");
    loadStyle("//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css");
  });
</script>

    </div>
  </body>

</html>
