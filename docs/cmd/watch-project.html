<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>watch-project | Watchman</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="watch-project" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Since 3.1." />
<meta property="og:description" content="Since 3.1." />
<link rel="canonical" href="https://facebook.github.io/watchman/docs/cmd/watch-project.html" />
<meta property="og:url" content="https://facebook.github.io/watchman/docs/cmd/watch-project.html" />
<meta property="og:site_name" content="Watchman" />
<meta property="og:image" content="https://facebook.github.io/watchman/static/og_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-03T15:40:25+00:00" />
<script type="application/ld+json">
{"headline":"watch-project","url":"https://facebook.github.io/watchman/docs/cmd/watch-project.html","dateModified":"2020-12-03T15:40:25+00:00","datePublished":"2020-12-03T15:40:25+00:00","description":"Since 3.1.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://facebook.github.io/watchman/static/logo.png"}},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://facebook.github.io/watchman/docs/cmd/watch-project.html"},"image":"https://facebook.github.io/watchman/static/og_image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" type="text/css" media="screen" href="/watchman/css/main.css">
  <link rel="icon" href="static/favicon.png" type="image/x-icon">

  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.min.js"></script>
  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>

  
  <link type="application/atom+xml" rel="alternate" href="https://facebook.github.io/watchman/feed.xml" title="Watchman" />
</head>

  <body>    
    <div id="fixed_header" class="fixedHeaderContainer visible">
  <header>
    <a href="https://facebook.github.io/watchman/"><img src="/watchman/static/logo.png" /><h2>Watchman</h2></a>
    <div class="navigationWrapper navigationFull" id="flat_nav">
      <nav class="navigation">
        <ul>
          
          <li class="navItem navItemActive">
            <a href=/watchman/docs/install.html>Docs</a>
          </li>
          
          <li class="navItem ">
            <a href=/watchman/support.html>Support</a>
          </li>
          
          <li class="navItem ">
            <a href=http://github.com/facebook/watchman>GitHub</a>
          </li>
          
        </ul>
      </nav>
    </div>
    <div class="navigationWrapper navigationSlider" id="navigation_wrap"></div>
  </header>
  <script>
    var event = document.createEvent('Event');
    event.initEvent('slide', true, true);
    document.addEventListener('slide', function (e) {
      document.body.classList.toggle('sliderActive');
    }, false);
    var navData = [
      
      {
        href       : "/watchman/docs/install.html",
        text       : "Docs",
      },
      
      {
        href       : "/watchman/support.html",
        text       : "Support",
      },
      
      {
        href       : "http://github.com/facebook/watchman",
        text       : "GitHub",
      },
      
    ];
  </script>
  <script type="text/javascript">  
  window.addEventListener('load', function() {
    var Nav = React.createClass({displayName: "Nav",
      getInitialState: function() {
        return {
          currentPath: window.location.pathname,
          slideoutActive: false,
        };
      },
      getDefaultProps: function() {
        return {
          data: navData,
        }
      },
      handleClick: function(id) {
        this.setState({
          slideoutActive: false,
        });
        document.dispatchEvent(event);
      },
      handleSlide: function(id) {
        this.setState({
          slideoutActive: !this.state.slideoutActive,
        });
        document.dispatchEvent(event);
      },
      render: function() {
        var classes = React.addons.classSet({
          'navSlideout': true,
          'navSlideoutActive': this.state.slideoutActive,
        });
        var navClasses = React.addons.classSet({
          'slidingNav': true,
          'slidingNavActive': this.state.slideoutActive,
        });
        return (
          React.createElement("div", null, 
            React.createElement("div", {className: classes, onClick: this.handleSlide}, 
              React.createElement("i", {className: "fa fa-bars"})
            ), 
            React.createElement("nav", {className: navClasses}, 
              React.createElement("ul", null, 
                this.props.data.map(this.renderNavItems)
              )
            )
          )
        );
      },
      renderNavItems: function(child, index) {
        var classes = React.addons.classSet({
          'navItem': true,
          'navItemActive': this.state.currentPath === child.href,
        });
        return (
          React.createElement("li", {key: index, className: classes}, 
            React.createElement("a", {onClick: this.handleClick, href: child.href}, child.text)
          )
        );
      },
    });

    function render(navData) {
      React.render(
        React.createElement(Nav, {data: navData}),
        document.getElementById('navigation_wrap')
      );
    }
    render(navData);
  });
  </script>
</div>

    <div class="navPusher">
      <div class="mainContainer blogContainer postContainer">
  <div id="main_wrap" class="wrapper mainWrapper">
    <div>
</div>
<nav class='toc' id="doc_nav"></nav>
<script>
  var docnavData = [
    
    {
      group     : "Installation",
      items     : [
        
          
        {
          key : "/watchman/docs/install.html",
          title : "Installation",
          url : "/watchman/docs/install.html",
        },
        
          
        {
          key : "/watchman/docs/release-notes.html",
          title : "Release Notes",
          url : "/watchman/docs/release-notes.html",
        }
        
      ],
    },
    
    {
      group     : "Invocation",
      items     : [
        
          
        {
          key : "/watchman/docs/cli-options.html",
          title : "Command Line",
          url : "/watchman/docs/cli-options.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-make.html",
          title : "watchman-make",
          url : "/watchman/docs/watchman-make.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-wait.html",
          title : "watchman-wait",
          url : "/watchman/docs/watchman-wait.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-replicate-subscription.html",
          title : "watchman-replicate-subscription",
          url : "/watchman/docs/watchman-replicate-subscription.html",
        },
        
          
        {
          key : "/watchman/docs/cppclient.html",
          title : "C++ Client",
          url : "/watchman/docs/cppclient.html",
        },
        
          
        {
          key : "/watchman/docs/nodejs.html",
          title : "NodeJS",
          url : "/watchman/docs/nodejs.html",
        },
        
          
        {
          key : "/watchman/docs/config.html",
          title : "Configuration Files",
          url : "/watchman/docs/config.html",
        },
        
          
        {
          key : "/watchman/docs/socket-interface.html",
          title : "Socket Interface",
          url : "/watchman/docs/socket-interface.html",
        }
        
      ],
    },
    
    {
      group     : "Compatibility",
      items     : [
        
          
        {
          key : "/watchman/docs/compatibility.html",
          title : "Compatibility Rules",
          url : "/watchman/docs/compatibility.html",
        },
        
          
        {
          key : "/watchman/docs/capabilities.html",
          title : "Capabilities",
          url : "/watchman/docs/capabilities.html",
        }
        
      ],
    },
    
    {
      group     : "Commands",
      items     : [
        
          
        {
          key : "/watchman/docs/cmd/clock.html",
          title : "clock",
          url : "/watchman/docs/cmd/clock.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/find.html",
          title : "find",
          url : "/watchman/docs/cmd/find.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/flush-subscriptions.html",
          title : "flush-subscriptions",
          url : "/watchman/docs/cmd/flush-subscriptions.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-config.html",
          title : "get-config",
          url : "/watchman/docs/cmd/get-config.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-sockname.html",
          title : "get-sockname",
          url : "/watchman/docs/cmd/get-sockname.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/list-capabilities.html",
          title : "list-capabilities",
          url : "/watchman/docs/cmd/list-capabilities.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log.html",
          title : "log",
          url : "/watchman/docs/cmd/log.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log-level.html",
          title : "log-level",
          url : "/watchman/docs/cmd/log-level.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/query.html",
          title : "query",
          url : "/watchman/docs/cmd/query.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/shutdown-server.html",
          title : "shutdown-server",
          url : "/watchman/docs/cmd/shutdown-server.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/since.html",
          title : "since",
          url : "/watchman/docs/cmd/since.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-enter.html",
          title : "state-enter",
          url : "/watchman/docs/cmd/state-enter.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-leave.html",
          title : "state-leave",
          url : "/watchman/docs/cmd/state-leave.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/subscribe.html",
          title : "subscribe",
          url : "/watchman/docs/cmd/subscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger.html",
          title : "trigger",
          url : "/watchman/docs/cmd/trigger.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-del.html",
          title : "trigger-del",
          url : "/watchman/docs/cmd/trigger-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-list.html",
          title : "trigger-list",
          url : "/watchman/docs/cmd/trigger-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/unsubscribe.html",
          title : "unsubscribe",
          url : "/watchman/docs/cmd/unsubscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/version.html",
          title : "version",
          url : "/watchman/docs/cmd/version.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch.html",
          title : "watch",
          url : "/watchman/docs/cmd/watch.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del.html",
          title : "watch-del",
          url : "/watchman/docs/cmd/watch-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del-all.html",
          title : "watch-del-all",
          url : "/watchman/docs/cmd/watch-del-all.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-list.html",
          title : "watch-list",
          url : "/watchman/docs/cmd/watch-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-project.html",
          title : "watch-project",
          url : "/watchman/docs/cmd/watch-project.html",
        }
        
      ],
    },
    
    {
      group     : "Queries",
      items     : [
        
          
        {
          key : "/watchman/docs/clockspec.html",
          title : "Clockspec",
          url : "/watchman/docs/clockspec.html",
        },
        
          
        {
          key : "/watchman/docs/file-query.html",
          title : "File Queries",
          url : "/watchman/docs/file-query.html",
        },
        
          
        {
          key : "/watchman/docs/simple-query.html",
          title : "Simple Pattern Syntax",
          url : "/watchman/docs/simple-query.html",
        },
        
          
        {
          key : "/watchman/docs/scm-query.html",
          title : "Source Control Aware Queries",
          url : "/watchman/docs/scm-query.html",
        }
        
      ],
    },
    
    {
      group     : "Expression Terms",
      items     : [
        
          
        {
          key : "/watchman/docs/expr/allof.html",
          title : "allof",
          url : "/watchman/docs/expr/allof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/anyof.html",
          title : "anyof",
          url : "/watchman/docs/expr/anyof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/dirname.html",
          title : "dirname & idirname",
          url : "/watchman/docs/expr/dirname.html",
        },
        
          
        {
          key : "/watchman/docs/expr/empty.html",
          title : "empty",
          url : "/watchman/docs/expr/empty.html",
        },
        
          
        {
          key : "/watchman/docs/expr/exists.html",
          title : "exists",
          url : "/watchman/docs/expr/exists.html",
        },
        
          
        {
          key : "/watchman/docs/expr/match.html",
          title : "match & imatch",
          url : "/watchman/docs/expr/match.html",
        },
        
          
        {
          key : "/watchman/docs/expr/name.html",
          title : "name & iname",
          url : "/watchman/docs/expr/name.html",
        },
        
          
        {
          key : "/watchman/docs/expr/not.html",
          title : "not",
          url : "/watchman/docs/expr/not.html",
        },
        
          
        {
          key : "/watchman/docs/expr/pcre.html",
          title : "pcre & ipcre",
          url : "/watchman/docs/expr/pcre.html",
        },
        
          
        {
          key : "/watchman/docs/expr/since.html",
          title : "since",
          url : "/watchman/docs/expr/since.html",
        },
        
          
        {
          key : "/watchman/docs/expr/size.html",
          title : "size",
          url : "/watchman/docs/expr/size.html",
        },
        
          
        {
          key : "/watchman/docs/expr/suffix.html",
          title : "suffix",
          url : "/watchman/docs/expr/suffix.html",
        },
        
          
        {
          key : "/watchman/docs/expr/type.html",
          title : "type",
          url : "/watchman/docs/expr/type.html",
        }
        
      ],
    },
    
    {
      group     : "Internals",
      items     : [
        
          
        {
          key : "/watchman/docs/bser.html",
          title : "BSER Binary Protocol",
          url : "/watchman/docs/bser.html",
        },
        
          
        {
          key : "/watchman/docs/casefolding.html",
          title : "Case-Insensitivity",
          url : "/watchman/docs/casefolding.html",
        },
        
          
        {
          key : "/watchman/contributing.html",
          title : "Contributing",
          url : "/watchman/contributing.html",
        },
        
          
        {
          key : "/watchman/docs/cookies.html",
          title : "Query Synchronization",
          url : "/watchman/docs/cookies.html",
        }
        
      ],
    },
    
    {
      group     : "Troubleshooting",
      items     : [
        
          
        {
          key : "/watchman/docs/troubleshooting.html",
          title : "Troubleshooting",
          url : "/watchman/docs/troubleshooting.html",
        }
        
      ],
    },
    
  ];
</script>
<script type="text/javascript">
window.addEventListener('load', function() {
  var DocNav = React.createClass({displayName: "DocNav",
    getInitialState: function() {
      return {
        toggleActive: false,
      };
    },
    getDefaultProps: function() {
      return {
        currentDoc: "watch-project",
        currentGroup: "Commands",
        data: docnavData,
      }
    },
    handleSlide: function(id) {
      this.setState({
        toggleActive: !this.state.toggleActive,
      });
    },
    render: function() {
      var classes = React.addons.classSet({
        'navToggle': true,
        'navToggleActive': this.state.toggleActive,
      });
      var navClasses = React.addons.classSet({
        'toggleNav': true,
        'toggleNavActive': this.state.toggleActive,
      });
      return (
        React.createElement("div", {className: navClasses},
          React.createElement("section", null,
            this.props.data.map(this.renderNavGroups)
          ),
          React.createElement("div", {className: classes, onClick: this.handleSlide}, React.createElement("i", {className: "fa fa-chevron-circle-down"}))
        )
      );
    },
    renderNavGroups: function(child, index) {
      var classes = React.addons.classSet({
        'navGroup': true,
        'navGroupActive': this.props.currentGroup === child.group,
      });
      return (
        React.createElement("div", {className: classes, key: index},
          React.createElement("h3", null, child.group),
          React.createElement("ul", null,
            child.items.map(this.renderNavItems)
          )
        )
      );
    },
    renderNavItems: function(child, index) {
      var itemClasses = React.addons.classSet({
        'navListItem': true,
        'navListItemActive': this.props.currentDoc === child.title,
      });
      var classes = React.addons.classSet({
        'navItem': true,
        'navItemActive': this.props.currentDoc === child.title,
      });
      return (
        React.createElement("li", {className: itemClasses, key: index}, React.createElement("a", {className: classes, href: child.url},  child.title))
      );
    },
  });

  function docNavRender(docnavData) {
    React.render(
      React.createElement(DocNav, {data: docnavData}),
      document.getElementById('doc_nav')
    );
  }
  docNavRender(docnavData);
});
</script>

    <div class="post">
  <header class="post-header">
    <h1 class="post-title">watch-project</h1>
  </header>

  <article class="post-content">
   
      <p><em>Since 3.1.</em></p>

<p>Requests that the <em>project</em> containing the requested dir is watched for
changes.  Watchman will track all files and dirs rooted at the <em>project</em> path,
and respond with the relative path difference between the <em>project</em> path and
the requested dir.</p>

<h3 id="rationale">Rationale</h3>

<p>With a proliferation of tools that wish to take advantage of
filesystem watching at different locations in a filesystem tree, it is
possible and likely for those tools to establish multiple overlapping
watches.</p>

<p>Most systems have a finite limit on the number of directories that can be
watched effectively; when that limit is exceeded the performance and
reliability of filesystem watching is degraded, sometimes to the point that it
ceases to function.</p>

<p>It is therefore desirable to avoid this situation and consolidate the
filesystem watches.  Watchman offers the <code class="language-plaintext highlighter-rouge">watch-project</code> command to allow
clients to opt-in to the watch consolidation behavior described below.</p>

<h3 id="whats-a-project-path">What’s a project path?</h3>

<p>A project is the logical root of a set of related files in a filesystem tree
and is a good point at which to consolidate watches.  Tools such as
<a href="https://bitbucket.org/facebook/hgwatchman">hgwatchman</a> will most likely have
already established a watch at the root of a project, so any other tools that
wish to watch a sub-directory can do so for no additional cost if they re-use
that existing watch at a higher level in the filesystem tree.</p>

<p>The <code class="language-plaintext highlighter-rouge">watch-project</code> command uses a simple procedure to locate the
<em>project</em> path that corresponds to a given path.  While simple it is
rather verbose to describe it precisely:</p>

<ol>
  <li>The search is begun with a list of file names; we’ll refer to it as
<code class="language-plaintext highlighter-rouge">root_files</code>.  Any file in this list, if present in a directory,
identifies that directory as being a valid project directory.</li>
  <li>The search is begun with the candidate directory set to the argument
passed to <code class="language-plaintext highlighter-rouge">watch-project</code>.  The candidate directory is passed to
the <code class="language-plaintext highlighter-rouge">realpath(3)</code> function and the result is set as the new value
of the candidate directory.</li>
  <li>The candidate directory is concatenated with each of the <code class="language-plaintext highlighter-rouge">root_files</code>,
one by one, and the resultant path is tested for existence.  If the
path exists then the candidate directory is the path that will be used
for watch and the search is halted successfully.</li>
  <li>If none of the <code class="language-plaintext highlighter-rouge">root_files</code> can be found in the candidate directory
then the parent of the candidate directory is used as a new candidate
and the process is repeated at step 3 above.</li>
  <li>If no viable candidates are found and the root of the filesystem is reached,
then the search terminates unsuccessfully.</li>
</ol>

<p>Watchman may perform the above search procedure twice.  The logic is:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">root_files</code> will be set to list only <code class="language-plaintext highlighter-rouge">.watchmanconfig</code></li>
  <li>Perform the search procedure above</li>
  <li>If the search terminates successfully, then the watch is established
for the current value of the candidate directory.</li>
  <li>If the search terminates unsuccessfully, <code class="language-plaintext highlighter-rouge">root_files</code> is set to
the global configuration option <a href="../config.html#root_files">root_files</a>
and the search procedure is re-run.</li>
  <li>If the search terminates successfully, then the watch is established
for the current value of the candidate directory.</li>
  <li>If the global configuration option
<a href="../config.html#enforce_root_files">enforce_root_files</a> is set to true
then the watch attempt fails.</li>
  <li>Otherwise, the watch is established for the original argument to the
<code class="language-plaintext highlighter-rouge">watch-project</code> command</li>
</ol>

<p>What this means in laymans terms is that the definitive location  of the
project root is where the <code class="language-plaintext highlighter-rouge">.watchmanconfig</code> file is found.  If it is
not found then the set of files defined by the <code class="language-plaintext highlighter-rouge">root_files</code> configuration
is used to locate a candidate.</p>

<p>If no viable candidate is found then watchman will watch the requested
directory, unless the <code class="language-plaintext highlighter-rouge">enforce_root_files</code> setting is set to true.</p>

<p>The default value for <code class="language-plaintext highlighter-rouge">root_files</code> will match most common version control
root directories.  The default value for <code class="language-plaintext highlighter-rouge">enforce_root_files</code> is <code class="language-plaintext highlighter-rouge">false</code>.</p>

<h3 id="using-watch-project">Using watch-project</h3>

<p>Assuming that <code class="language-plaintext highlighter-rouge">~/www/.hg</code> and <code class="language-plaintext highlighter-rouge">~/www/some/child/dir</code> both exist, then
the command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman watch-project ~/www/some/child/dir
<span class="o">{</span>
  <span class="s2">"version"</span>: <span class="s2">"3.0.1"</span>,
  <span class="s2">"watch"</span>: <span class="s2">"/Users/wez/www"</span>,
  <span class="s2">"relative_path"</span>: <span class="s2">"some/child/dir"</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>establishes a watch on the <code class="language-plaintext highlighter-rouge">~/www</code> directory because that is the directory
that contains <code class="language-plaintext highlighter-rouge">.hg</code>, which is one of the items listed in the default value
for <code class="language-plaintext highlighter-rouge">root_files</code>.</p>

<p>As a client using <code class="language-plaintext highlighter-rouge">watch-project</code> it is important to observe the
<code class="language-plaintext highlighter-rouge">relative_path</code> and/or <code class="language-plaintext highlighter-rouge">watch</code> elements of the response; they identify which
directory is actually being watched.  <strong>Any triggers, subscriptions or queries
that the client issues must be relative to the watched root to operate as
expected.</strong>  A client can use <code class="language-plaintext highlighter-rouge">relative_path</code> to more easily construct
queries or adjust the results of queries by either concatenating the string
when composing paths in a query expression or removing the string from the
prefix when processing the results.</p>

<p>If <code class="language-plaintext highlighter-rouge">relative_path</code> is missing from the response it means that the requested
dir is the same as the watched dir and that the <code class="language-plaintext highlighter-rouge">watch-project</code> invocation
turned out to be exactly equivalent to a <code class="language-plaintext highlighter-rouge">watch</code> invocation for the requested
directory.</p>

<p>Note that, when you’re using the CLI, you can specify the root as
<code class="language-plaintext highlighter-rouge">~/www/some/child/dir</code> because the shell will resolve <code class="language-plaintext highlighter-rouge">~/www/some/child/dir</code> to
<code class="language-plaintext highlighter-rouge">/Users/wez/www/some/child/dir</code>, but when you use the JSON protocol, you are
responsible for supplying an absolute path.</p>

<p>JSON:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="s2">"watch"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/Users/wez/www/some/child/dir"</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="initiating-a-watch">Initiating a watch</h3>

<p>Once a viable candidate is found, if watchman is not already watching the
directory, then watchman will:</p>

<ul>
  <li>Establish change notification for the directory with the kernel</li>
  <li>Queues up a request to crawl the directory</li>
  <li>As the directory contents are resolved, those are watched in a similar
fashion</li>
  <li>All newly observed files are considered changed</li>
</ul>

<h3 id="persistence">Persistence</h3>

<p>Unless the <code class="language-plaintext highlighter-rouge">--no-save-state</code> server option was used to start the watchman
service, watches and their associated triggers are saved and re-established
across a process restart.</p>

<p><em>Since 3.7.</em></p>

<p>The watchman service may decide to reap watches that have been idle for an
extended period of time.  A watch is considered to be idle if no watchman
queries have been issued against the watch.  If a watch is idle, and has no
triggers registered or active subscriptions then it is a candidate for reaping.</p>

<p>The <a href="../config.html#idle-reap-age-seconds">idle_reap_age_seconds</a> configuration
parameter controls the idle timeout for a watch.  The default is 5 days.
A reaped watch is cancelled and removed from the state file.</p>

    
  </article>
</div>

  </div>
</div>


      <div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <section id="fb_oss" class="fbOpenSourceFooter">
      <a href="https://code.facebook.com/projects/" target="_blank"><img src="/watchman/static/oss_logo.png" alt="Facebook Open Source" title="Facebook Open Source" /></a>
    </section>
  </div>
</div>
<script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = window.location.href.replace(window.location.hash, '') + "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  window.addEventListener('load', function() {
    var contentBlock = document.getElementsByClassName("post")[0] || document.getElementsByClassName("news")[0];
    if (!contentBlock) {
      return;
    }
    for (var level = 1; level <= 6; level++) {
      linkifyAnchors(level, contentBlock);
    }
  });
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44373548-13', 'auto');
  ga('send', 'pageview');
</script>
<script>
  window.addEventListener('load', function() {
    hljs.initHighlightingOnLoad();

    // Async load some styles
    function loadStyle(href) {
      var s = document.createElement('link');
      s.setAttribute('rel', 'stylesheet');
      s.setAttribute('href', href);
      s.setAttribute('type', 'text/css');
      document.getElementsByTagName('head')[0].appendChild(s);
    }
    loadStyle("//nuclide.io/static/fonts/332720/BC699FA675F9356E3.css");
    loadStyle("//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css");
    loadStyle("//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css");
  });
</script>

    </div>
  </body>

</html>
