<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Command Line | Watchman</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Command Line" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The watchman executable contains both the client and the server components of the watchman service." />
<meta property="og:description" content="The watchman executable contains both the client and the server components of the watchman service." />
<link rel="canonical" href="https://facebook.github.io/watchman/docs/cli-options.html" />
<meta property="og:url" content="https://facebook.github.io/watchman/docs/cli-options.html" />
<meta property="og:site_name" content="Watchman" />
<meta property="og:image" content="https://facebook.github.io/watchman/static/og_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-03T15:40:25+00:00" />
<script type="application/ld+json">
{"headline":"Command Line","url":"https://facebook.github.io/watchman/docs/cli-options.html","dateModified":"2020-12-03T15:40:25+00:00","datePublished":"2020-12-03T15:40:25+00:00","description":"The watchman executable contains both the client and the server components of the watchman service.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://facebook.github.io/watchman/static/logo.png"}},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://facebook.github.io/watchman/docs/cli-options.html"},"image":"https://facebook.github.io/watchman/static/og_image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" type="text/css" media="screen" href="/watchman/css/main.css">
  <link rel="icon" href="static/favicon.png" type="image/x-icon">

  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.min.js"></script>
  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>

  
  <link type="application/atom+xml" rel="alternate" href="https://facebook.github.io/watchman/feed.xml" title="Watchman" />
</head>

  <body>    
    <div id="fixed_header" class="fixedHeaderContainer visible">
  <header>
    <a href="https://facebook.github.io/watchman/"><img src="/watchman/static/logo.png" /><h2>Watchman</h2></a>
    <div class="navigationWrapper navigationFull" id="flat_nav">
      <nav class="navigation">
        <ul>
          
          <li class="navItem navItemActive">
            <a href=/watchman/docs/install.html>Docs</a>
          </li>
          
          <li class="navItem ">
            <a href=/watchman/support.html>Support</a>
          </li>
          
          <li class="navItem ">
            <a href=http://github.com/facebook/watchman>GitHub</a>
          </li>
          
        </ul>
      </nav>
    </div>
    <div class="navigationWrapper navigationSlider" id="navigation_wrap"></div>
  </header>
  <script>
    var event = document.createEvent('Event');
    event.initEvent('slide', true, true);
    document.addEventListener('slide', function (e) {
      document.body.classList.toggle('sliderActive');
    }, false);
    var navData = [
      
      {
        href       : "/watchman/docs/install.html",
        text       : "Docs",
      },
      
      {
        href       : "/watchman/support.html",
        text       : "Support",
      },
      
      {
        href       : "http://github.com/facebook/watchman",
        text       : "GitHub",
      },
      
    ];
  </script>
  <script type="text/javascript">  
  window.addEventListener('load', function() {
    var Nav = React.createClass({displayName: "Nav",
      getInitialState: function() {
        return {
          currentPath: window.location.pathname,
          slideoutActive: false,
        };
      },
      getDefaultProps: function() {
        return {
          data: navData,
        }
      },
      handleClick: function(id) {
        this.setState({
          slideoutActive: false,
        });
        document.dispatchEvent(event);
      },
      handleSlide: function(id) {
        this.setState({
          slideoutActive: !this.state.slideoutActive,
        });
        document.dispatchEvent(event);
      },
      render: function() {
        var classes = React.addons.classSet({
          'navSlideout': true,
          'navSlideoutActive': this.state.slideoutActive,
        });
        var navClasses = React.addons.classSet({
          'slidingNav': true,
          'slidingNavActive': this.state.slideoutActive,
        });
        return (
          React.createElement("div", null, 
            React.createElement("div", {className: classes, onClick: this.handleSlide}, 
              React.createElement("i", {className: "fa fa-bars"})
            ), 
            React.createElement("nav", {className: navClasses}, 
              React.createElement("ul", null, 
                this.props.data.map(this.renderNavItems)
              )
            )
          )
        );
      },
      renderNavItems: function(child, index) {
        var classes = React.addons.classSet({
          'navItem': true,
          'navItemActive': this.state.currentPath === child.href,
        });
        return (
          React.createElement("li", {key: index, className: classes}, 
            React.createElement("a", {onClick: this.handleClick, href: child.href}, child.text)
          )
        );
      },
    });

    function render(navData) {
      React.render(
        React.createElement(Nav, {data: navData}),
        document.getElementById('navigation_wrap')
      );
    }
    render(navData);
  });
  </script>
</div>

    <div class="navPusher">
      <div class="mainContainer blogContainer postContainer">
  <div id="main_wrap" class="wrapper mainWrapper">
    <div>
</div>
<nav class='toc' id="doc_nav"></nav>
<script>
  var docnavData = [
    
    {
      group     : "Installation",
      items     : [
        
          
        {
          key : "/watchman/docs/install.html",
          title : "Installation",
          url : "/watchman/docs/install.html",
        },
        
          
        {
          key : "/watchman/docs/release-notes.html",
          title : "Release Notes",
          url : "/watchman/docs/release-notes.html",
        }
        
      ],
    },
    
    {
      group     : "Invocation",
      items     : [
        
          
        {
          key : "/watchman/docs/cli-options.html",
          title : "Command Line",
          url : "/watchman/docs/cli-options.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-make.html",
          title : "watchman-make",
          url : "/watchman/docs/watchman-make.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-wait.html",
          title : "watchman-wait",
          url : "/watchman/docs/watchman-wait.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-replicate-subscription.html",
          title : "watchman-replicate-subscription",
          url : "/watchman/docs/watchman-replicate-subscription.html",
        },
        
          
        {
          key : "/watchman/docs/cppclient.html",
          title : "C++ Client",
          url : "/watchman/docs/cppclient.html",
        },
        
          
        {
          key : "/watchman/docs/nodejs.html",
          title : "NodeJS",
          url : "/watchman/docs/nodejs.html",
        },
        
          
        {
          key : "/watchman/docs/config.html",
          title : "Configuration Files",
          url : "/watchman/docs/config.html",
        },
        
          
        {
          key : "/watchman/docs/socket-interface.html",
          title : "Socket Interface",
          url : "/watchman/docs/socket-interface.html",
        }
        
      ],
    },
    
    {
      group     : "Compatibility",
      items     : [
        
          
        {
          key : "/watchman/docs/compatibility.html",
          title : "Compatibility Rules",
          url : "/watchman/docs/compatibility.html",
        },
        
          
        {
          key : "/watchman/docs/capabilities.html",
          title : "Capabilities",
          url : "/watchman/docs/capabilities.html",
        }
        
      ],
    },
    
    {
      group     : "Commands",
      items     : [
        
          
        {
          key : "/watchman/docs/cmd/clock.html",
          title : "clock",
          url : "/watchman/docs/cmd/clock.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/find.html",
          title : "find",
          url : "/watchman/docs/cmd/find.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/flush-subscriptions.html",
          title : "flush-subscriptions",
          url : "/watchman/docs/cmd/flush-subscriptions.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-config.html",
          title : "get-config",
          url : "/watchman/docs/cmd/get-config.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-sockname.html",
          title : "get-sockname",
          url : "/watchman/docs/cmd/get-sockname.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/list-capabilities.html",
          title : "list-capabilities",
          url : "/watchman/docs/cmd/list-capabilities.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log.html",
          title : "log",
          url : "/watchman/docs/cmd/log.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log-level.html",
          title : "log-level",
          url : "/watchman/docs/cmd/log-level.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/query.html",
          title : "query",
          url : "/watchman/docs/cmd/query.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/shutdown-server.html",
          title : "shutdown-server",
          url : "/watchman/docs/cmd/shutdown-server.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/since.html",
          title : "since",
          url : "/watchman/docs/cmd/since.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-enter.html",
          title : "state-enter",
          url : "/watchman/docs/cmd/state-enter.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-leave.html",
          title : "state-leave",
          url : "/watchman/docs/cmd/state-leave.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/subscribe.html",
          title : "subscribe",
          url : "/watchman/docs/cmd/subscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger.html",
          title : "trigger",
          url : "/watchman/docs/cmd/trigger.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-del.html",
          title : "trigger-del",
          url : "/watchman/docs/cmd/trigger-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-list.html",
          title : "trigger-list",
          url : "/watchman/docs/cmd/trigger-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/unsubscribe.html",
          title : "unsubscribe",
          url : "/watchman/docs/cmd/unsubscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/version.html",
          title : "version",
          url : "/watchman/docs/cmd/version.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch.html",
          title : "watch",
          url : "/watchman/docs/cmd/watch.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del.html",
          title : "watch-del",
          url : "/watchman/docs/cmd/watch-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del-all.html",
          title : "watch-del-all",
          url : "/watchman/docs/cmd/watch-del-all.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-list.html",
          title : "watch-list",
          url : "/watchman/docs/cmd/watch-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-project.html",
          title : "watch-project",
          url : "/watchman/docs/cmd/watch-project.html",
        }
        
      ],
    },
    
    {
      group     : "Queries",
      items     : [
        
          
        {
          key : "/watchman/docs/clockspec.html",
          title : "Clockspec",
          url : "/watchman/docs/clockspec.html",
        },
        
          
        {
          key : "/watchman/docs/file-query.html",
          title : "File Queries",
          url : "/watchman/docs/file-query.html",
        },
        
          
        {
          key : "/watchman/docs/simple-query.html",
          title : "Simple Pattern Syntax",
          url : "/watchman/docs/simple-query.html",
        },
        
          
        {
          key : "/watchman/docs/scm-query.html",
          title : "Source Control Aware Queries",
          url : "/watchman/docs/scm-query.html",
        }
        
      ],
    },
    
    {
      group     : "Expression Terms",
      items     : [
        
          
        {
          key : "/watchman/docs/expr/allof.html",
          title : "allof",
          url : "/watchman/docs/expr/allof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/anyof.html",
          title : "anyof",
          url : "/watchman/docs/expr/anyof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/dirname.html",
          title : "dirname & idirname",
          url : "/watchman/docs/expr/dirname.html",
        },
        
          
        {
          key : "/watchman/docs/expr/empty.html",
          title : "empty",
          url : "/watchman/docs/expr/empty.html",
        },
        
          
        {
          key : "/watchman/docs/expr/exists.html",
          title : "exists",
          url : "/watchman/docs/expr/exists.html",
        },
        
          
        {
          key : "/watchman/docs/expr/match.html",
          title : "match & imatch",
          url : "/watchman/docs/expr/match.html",
        },
        
          
        {
          key : "/watchman/docs/expr/name.html",
          title : "name & iname",
          url : "/watchman/docs/expr/name.html",
        },
        
          
        {
          key : "/watchman/docs/expr/not.html",
          title : "not",
          url : "/watchman/docs/expr/not.html",
        },
        
          
        {
          key : "/watchman/docs/expr/pcre.html",
          title : "pcre & ipcre",
          url : "/watchman/docs/expr/pcre.html",
        },
        
          
        {
          key : "/watchman/docs/expr/since.html",
          title : "since",
          url : "/watchman/docs/expr/since.html",
        },
        
          
        {
          key : "/watchman/docs/expr/size.html",
          title : "size",
          url : "/watchman/docs/expr/size.html",
        },
        
          
        {
          key : "/watchman/docs/expr/suffix.html",
          title : "suffix",
          url : "/watchman/docs/expr/suffix.html",
        },
        
          
        {
          key : "/watchman/docs/expr/type.html",
          title : "type",
          url : "/watchman/docs/expr/type.html",
        }
        
      ],
    },
    
    {
      group     : "Internals",
      items     : [
        
          
        {
          key : "/watchman/docs/bser.html",
          title : "BSER Binary Protocol",
          url : "/watchman/docs/bser.html",
        },
        
          
        {
          key : "/watchman/docs/casefolding.html",
          title : "Case-Insensitivity",
          url : "/watchman/docs/casefolding.html",
        },
        
          
        {
          key : "/watchman/contributing.html",
          title : "Contributing",
          url : "/watchman/contributing.html",
        },
        
          
        {
          key : "/watchman/docs/cookies.html",
          title : "Query Synchronization",
          url : "/watchman/docs/cookies.html",
        }
        
      ],
    },
    
    {
      group     : "Troubleshooting",
      items     : [
        
          
        {
          key : "/watchman/docs/troubleshooting.html",
          title : "Troubleshooting",
          url : "/watchman/docs/troubleshooting.html",
        }
        
      ],
    },
    
  ];
</script>
<script type="text/javascript">
window.addEventListener('load', function() {
  var DocNav = React.createClass({displayName: "DocNav",
    getInitialState: function() {
      return {
        toggleActive: false,
      };
    },
    getDefaultProps: function() {
      return {
        currentDoc: "Command Line",
        currentGroup: "Invocation",
        data: docnavData,
      }
    },
    handleSlide: function(id) {
      this.setState({
        toggleActive: !this.state.toggleActive,
      });
    },
    render: function() {
      var classes = React.addons.classSet({
        'navToggle': true,
        'navToggleActive': this.state.toggleActive,
      });
      var navClasses = React.addons.classSet({
        'toggleNav': true,
        'toggleNavActive': this.state.toggleActive,
      });
      return (
        React.createElement("div", {className: navClasses},
          React.createElement("section", null,
            this.props.data.map(this.renderNavGroups)
          ),
          React.createElement("div", {className: classes, onClick: this.handleSlide}, React.createElement("i", {className: "fa fa-chevron-circle-down"}))
        )
      );
    },
    renderNavGroups: function(child, index) {
      var classes = React.addons.classSet({
        'navGroup': true,
        'navGroupActive': this.props.currentGroup === child.group,
      });
      return (
        React.createElement("div", {className: classes, key: index},
          React.createElement("h3", null, child.group),
          React.createElement("ul", null,
            child.items.map(this.renderNavItems)
          )
        )
      );
    },
    renderNavItems: function(child, index) {
      var itemClasses = React.addons.classSet({
        'navListItem': true,
        'navListItemActive': this.props.currentDoc === child.title,
      });
      var classes = React.addons.classSet({
        'navItem': true,
        'navItemActive': this.props.currentDoc === child.title,
      });
      return (
        React.createElement("li", {className: itemClasses, key: index}, React.createElement("a", {className: classes, href: child.url},  child.title))
      );
    },
  });

  function docNavRender(docnavData) {
    React.render(
      React.createElement(DocNav, {data: docnavData}),
      document.getElementById('doc_nav')
    );
  }
  docNavRender(docnavData);
});
</script>

    <div class="post">
  <header class="post-header">
    <h1 class="post-title">Command Line</h1>
  </header>

  <article class="post-content">
   
      <p>The <code class="language-plaintext highlighter-rouge">watchman</code> executable contains both the client and the server components
of the watchman service.</p>

<p>By default, when <code class="language-plaintext highlighter-rouge">watchman</code> is run, it will attempt to communicate with your
existing server instance (each user has their own persistent process), and will
attempt to start it if it doesn’t exist.</p>

<p>There are some options that affect how <code class="language-plaintext highlighter-rouge">watchman</code> will locate the server, some
options that affect only the client and some others that affect only the
server.  Since all of the options are understood by the same executable we’ve
broken those out into sections of their own to make it clearer when they apply.</p>

<h2 id="quick-note-on-default-locations">Quick note on default locations</h2>

<p>Watchman will prefer to resolve your user name from the <code class="language-plaintext highlighter-rouge">$USER</code> environmental
variable, or <code class="language-plaintext highlighter-rouge">$LOGNAME</code> if <code class="language-plaintext highlighter-rouge">$USER</code> was not set.  If neither are set watchman
will look it up from the system using <code class="language-plaintext highlighter-rouge">getpwuid(getuid())</code>.  When we refer to
<code class="language-plaintext highlighter-rouge">&lt;USER&gt;</code> in this documentation we mean the result of this resolution.</p>

<p>In some cases Watchman will need to create files in a temporary location.
Watchman will resolve this temporary location by looking at the <code class="language-plaintext highlighter-rouge">$TMPDIR</code>
environmental variable, or <code class="language-plaintext highlighter-rouge">$TMP</code> if <code class="language-plaintext highlighter-rouge">$TMPDIR</code> was not set.  If neither are set
watchman will use <code class="language-plaintext highlighter-rouge">/tmp</code>.  When we refer to <code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;</code> in this documentation we
mean the result of this resolution.</p>

<p>Watchman tracks its persistent state in a location that we refer to as the
<code class="language-plaintext highlighter-rouge">&lt;STATEDIR&gt;</code> in this documentation.</p>

<p><em>Since 3.1.</em></p>

<p>The <code class="language-plaintext highlighter-rouge">STATEDIR</code> defaulted to <code class="language-plaintext highlighter-rouge">&lt;PREFIX&gt;/var/run/watchman</code>.  You can change this
default when you build watchman by using the configure option
<code class="language-plaintext highlighter-rouge">--enable-statedir</code>.</p>

<p>Earlier versions of Watchman didn’t have a default statedir and would instead
use the <code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;</code> for this state.  We switched away from that because some
environments randomize the <code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;</code> location and this made it difficult for
clients to locate the Watchman service.</p>

<p><em>Since 3.8.</em></p>

<p>The <code class="language-plaintext highlighter-rouge">STATEDIR</code> defaults to <code class="language-plaintext highlighter-rouge">&lt;PREFIX&gt;/var/run/watchman/&lt;USER&gt;-state</code>.  You can
change this default when you build watchman by using the configure option
<code class="language-plaintext highlighter-rouge">--enable-statedir</code>; the configure option replaces the
<code class="language-plaintext highlighter-rouge">&lt;PREFIX&gt;/var/run/watchman</code> portion of this string.  If you specify
<code class="language-plaintext highlighter-rouge">--disable-statedir</code> then that portion of the string will be computed from the
<code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;</code> location.</p>

<p>Watchman will create the <code class="language-plaintext highlighter-rouge">&lt;USER&gt;-state</code> portion if it does not exist, and will
perform some permission and ownership checks to reduce the risk of untrusted
users placing files in this location.  If those checks are not satisfied,
watchman will refuse to start.</p>

<h2 id="locating-the-service">Locating the service</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> -U, --sockname=PATH   Specify alternate sockname
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The default location for sockname will be <code class="language-plaintext highlighter-rouge">&lt;STATEDIR&gt;/&lt;USER&gt;</code>.  Older versions
of Watchman would default to <code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;/.watchman.&lt;USER&gt;</code>, depending on how
it was configured.</p>

<p>If you are building a client to access the service programmatically, we
recommend that you invoke <a href="/watchman/docs/cmd/get-sockname.html">watchman get-sockname</a> to discover the path that the client and
server would use.  This has the side effect of spawning the service for you if
it isn’t already running.</p>

<h2 id="client-options">Client Options</h2>

<p>The <code class="language-plaintext highlighter-rouge">watchman</code> executable will attempt to start the service if there is no
response on the socket specified above.  In some cases it is desirable to avoid
starting the service if it isn’t running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre> --no-spawn            Don't spawn service if it is not already running.
                       Will try running the command in client mode if
                       possible.
 --no-local            When no-spawn is enabled, don't use client mode
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Client mode implements the <a href="/watchman/docs/cmd/find.html">watchman find command</a> as an immediate search.</p>

<p>These options control how the client talks to the server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre> -p, --persistent           Persist and wait for further responses
     --server-encoding=ARG  CLI&lt;-&gt;server encoding. json or bser.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Persistent connections have relatively limited use with the CLI, but can be
useful to connect ad-hoc to the service to receive logging information (See
<a href="/watchman/docs/cmd/log-level.html">log-level</a>).</p>

<p>The server encoding option controls how requests and responses are formatted
when talking to the server.  You generally shouldn’t need to worry about this.</p>

<h3 id="input-and-output">Input and Output</h3>

<p>Most simple invocations of the CLI will pass a list of arguments:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman watch /path/to/dir
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This is turned into a request like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="s2">"watch"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/path/to/dir"</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>and sent to the service using the <a href="/watchman/docs/socket-interface.html">Socket Interface</a>.</p>

<p>The response is received and then sent to the <code class="language-plaintext highlighter-rouge">stdout</code> stream formatted based on
the selected output-encoding:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>     --output-encoding=ARG  CLI output encoding. json (default) or bser
     --no-pretty            Don't pretty print JSON output (more efficient
                            when being processed by another program)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Each command has its own response output but watchman will always include a
field named <code class="language-plaintext highlighter-rouge">error</code> if something about the request was not successful.  In case
of some protocol level errors (eg: connection was terminated) instead of
printing a response on <code class="language-plaintext highlighter-rouge">stdout</code>, an unstructured error message will be printed
to <code class="language-plaintext highlighter-rouge">stderr</code> and the process will exit with a non-zero exit status.</p>

<p>Instead of passing the request as command line parameters, you can send a JSON
representation on the <code class="language-plaintext highlighter-rouge">stdin</code> stream.  These invocations are all equivalent:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman watch /path/to/dir
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">-j</span> <span class="o">&lt;&lt;-</span><span class="no">EOT</span><span class="sh">
["watch", "/path/to/dir"]
</span><span class="no">EOT
</span></pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">-j</span> <span class="o">&lt;&lt;&lt;</span> <span class="s1">'["watch", "/path/to/dir"]'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'["watch", "/path/to/dir"]'</span> | watchman <span class="nt">-j</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'["watch", "/path/to/dir"]'</span> <span class="o">&gt;</span> cmd.json
<span class="nv">$ </span>watchman <span class="nt">-j</span> &lt; cmd.json
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">--json-command</span> <span class="o">&lt;&lt;-</span><span class="no">EOT</span><span class="sh">
["watch", "/path/to/dir"]
</span><span class="no">EOT
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><em>Since 3.8</em></p>

<p>The CLI now also recognizes BSER as a valid input stream when using the <code class="language-plaintext highlighter-rouge">-j</code>
option.  This will implicitly set <code class="language-plaintext highlighter-rouge">--server-encoding=bser</code> and
<code class="language-plaintext highlighter-rouge">--output-encoding=bser</code> if those options have not been set to something else.</p>

<h2 id="exit-status">Exit Status</h2>

<p>The <code class="language-plaintext highlighter-rouge">watchman</code> binary will exit with a return code of 0 in most cases; this
indicates that the output it generated should be valid JSON.  To determine if
your command was successful, you need to parse the JSON and look for the
<code class="language-plaintext highlighter-rouge">error</code> field as described above.</p>

<p><code class="language-plaintext highlighter-rouge">watchman</code> will exit with a non-zero exit status in cases where something
low-level went wrong, such as protocol level errors (eg: connection was
terminated).</p>

<h2 id="server-options">Server Options</h2>

<p>These options are used when starting the server.  They are recognized by the
client and affect how it will start the server, but have no effect if the
server is already running.  To change the effective values of these options
for a running server, you will need to restart it (you can stop it by running
<a href="/watchman/docs/cmd/shutdown-server.html">watchman shutdown-server</a>).</p>

<p>By default, watchman will remember all watches and associated triggers and
reinstate them if the process is restarted.  This state is stored in the
<em>statefile</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre> --statefile=PATH      Specify path to file to hold watch and trigger state
 -n, --no-save-state   Don't save state between invocations
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The default location for statefile will be <code class="language-plaintext highlighter-rouge">&lt;STATEDIR&gt;/&lt;USER&gt;.state</code>.  Older
versions of watchman may store the state in <code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;/.watchman.&lt;USER&gt;.state</code>,
depending on how they were configured.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>-o, --logfile=PATH   Specify path to logfile
    --log-level      set log verbosity (0 = off, default is 1, verbose = 2)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The default location for logfile will be <code class="language-plaintext highlighter-rouge">&lt;STATEDIR&gt;/&lt;USER&gt;.log</code>.  Older
versions of watchman may store the logs in <code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;/.watchman.&lt;USER&gt;.log</code>,
depending on how they were configured.</p>

<p>In some relatively uncommon circumstances, such as in test harnesses, you may
need to directly run the service without it putting itself into the background:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> -f, --foreground      Run the service in the foreground
</pre></td></tr></tbody></table></code></pre></div></div>

<p><em>Since 4.6.</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>     --inetd                Spawning from an inetd style supervisor
</pre></td></tr></tbody></table></code></pre></div></div>

<p>When this flag is specified, watchman will use stdin as the listening socket
rather than attempting to set it up for itself.  This allows some other process
to maintain the socket and defer activating the watchman service until a client
is ready to connect.  This is most practically beneficial when used together
with <code class="language-plaintext highlighter-rouge">systemd</code>.</p>

<p><a href="https://github.com/facebook/watchman/commit/2985377eaf8c8538b28fae9add061b67991a87c2">This commit includes a sample configuration for systemd</a>.</p>

    
  </article>
</div>

  </div>
</div>


      <div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <section id="fb_oss" class="fbOpenSourceFooter">
      <a href="https://code.facebook.com/projects/" target="_blank"><img src="/watchman/static/oss_logo.png" alt="Facebook Open Source" title="Facebook Open Source" /></a>
    </section>
  </div>
</div>
<script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = window.location.href.replace(window.location.hash, '') + "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  window.addEventListener('load', function() {
    var contentBlock = document.getElementsByClassName("post")[0] || document.getElementsByClassName("news")[0];
    if (!contentBlock) {
      return;
    }
    for (var level = 1; level <= 6; level++) {
      linkifyAnchors(level, contentBlock);
    }
  });
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44373548-13', 'auto');
  ga('send', 'pageview');
</script>
<script>
  window.addEventListener('load', function() {
    hljs.initHighlightingOnLoad();

    // Async load some styles
    function loadStyle(href) {
      var s = document.createElement('link');
      s.setAttribute('rel', 'stylesheet');
      s.setAttribute('href', href);
      s.setAttribute('type', 'text/css');
      document.getElementsByTagName('head')[0].appendChild(s);
    }
    loadStyle("//nuclide.io/static/fonts/332720/BC699FA675F9356E3.css");
    loadStyle("//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css");
    loadStyle("//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css");
  });
</script>

    </div>
  </body>

</html>
