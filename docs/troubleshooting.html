<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Troubleshooting | Watchman</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Troubleshooting" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="We try to give directed advice in Watchman error diagnostics, which means that we will show a link to a section on this page with some context and advice where we have enough information to do so. Some operating systems provide richer diagnostic information than others, so we have to resort to more generic advice in some cases." />
<meta property="og:description" content="We try to give directed advice in Watchman error diagnostics, which means that we will show a link to a section on this page with some context and advice where we have enough information to do so. Some operating systems provide richer diagnostic information than others, so we have to resort to more generic advice in some cases." />
<link rel="canonical" href="https://facebook.github.io/watchman/docs/troubleshooting.html" />
<meta property="og:url" content="https://facebook.github.io/watchman/docs/troubleshooting.html" />
<meta property="og:site_name" content="Watchman" />
<meta property="og:image" content="https://facebook.github.io/watchman/static/og_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-03T15:40:25+00:00" />
<script type="application/ld+json">
{"headline":"Troubleshooting","url":"https://facebook.github.io/watchman/docs/troubleshooting.html","dateModified":"2020-12-03T15:40:25+00:00","datePublished":"2020-12-03T15:40:25+00:00","description":"We try to give directed advice in Watchman error diagnostics, which means that we will show a link to a section on this page with some context and advice where we have enough information to do so. Some operating systems provide richer diagnostic information than others, so we have to resort to more generic advice in some cases.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://facebook.github.io/watchman/static/logo.png"}},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://facebook.github.io/watchman/docs/troubleshooting.html"},"image":"https://facebook.github.io/watchman/static/og_image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" type="text/css" media="screen" href="/watchman/css/main.css">
  <link rel="icon" href="static/favicon.png" type="image/x-icon">

  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.min.js"></script>
  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>

  
  <link type="application/atom+xml" rel="alternate" href="https://facebook.github.io/watchman/feed.xml" title="Watchman" />
</head>

  <body>    
    <div id="fixed_header" class="fixedHeaderContainer visible">
  <header>
    <a href="https://facebook.github.io/watchman/"><img src="/watchman/static/logo.png" /><h2>Watchman</h2></a>
    <div class="navigationWrapper navigationFull" id="flat_nav">
      <nav class="navigation">
        <ul>
          
          <li class="navItem navItemActive">
            <a href=/watchman/docs/install.html>Docs</a>
          </li>
          
          <li class="navItem ">
            <a href=/watchman/support.html>Support</a>
          </li>
          
          <li class="navItem ">
            <a href=http://github.com/facebook/watchman>GitHub</a>
          </li>
          
        </ul>
      </nav>
    </div>
    <div class="navigationWrapper navigationSlider" id="navigation_wrap"></div>
  </header>
  <script>
    var event = document.createEvent('Event');
    event.initEvent('slide', true, true);
    document.addEventListener('slide', function (e) {
      document.body.classList.toggle('sliderActive');
    }, false);
    var navData = [
      
      {
        href       : "/watchman/docs/install.html",
        text       : "Docs",
      },
      
      {
        href       : "/watchman/support.html",
        text       : "Support",
      },
      
      {
        href       : "http://github.com/facebook/watchman",
        text       : "GitHub",
      },
      
    ];
  </script>
  <script type="text/javascript">  
  window.addEventListener('load', function() {
    var Nav = React.createClass({displayName: "Nav",
      getInitialState: function() {
        return {
          currentPath: window.location.pathname,
          slideoutActive: false,
        };
      },
      getDefaultProps: function() {
        return {
          data: navData,
        }
      },
      handleClick: function(id) {
        this.setState({
          slideoutActive: false,
        });
        document.dispatchEvent(event);
      },
      handleSlide: function(id) {
        this.setState({
          slideoutActive: !this.state.slideoutActive,
        });
        document.dispatchEvent(event);
      },
      render: function() {
        var classes = React.addons.classSet({
          'navSlideout': true,
          'navSlideoutActive': this.state.slideoutActive,
        });
        var navClasses = React.addons.classSet({
          'slidingNav': true,
          'slidingNavActive': this.state.slideoutActive,
        });
        return (
          React.createElement("div", null, 
            React.createElement("div", {className: classes, onClick: this.handleSlide}, 
              React.createElement("i", {className: "fa fa-bars"})
            ), 
            React.createElement("nav", {className: navClasses}, 
              React.createElement("ul", null, 
                this.props.data.map(this.renderNavItems)
              )
            )
          )
        );
      },
      renderNavItems: function(child, index) {
        var classes = React.addons.classSet({
          'navItem': true,
          'navItemActive': this.state.currentPath === child.href,
        });
        return (
          React.createElement("li", {key: index, className: classes}, 
            React.createElement("a", {onClick: this.handleClick, href: child.href}, child.text)
          )
        );
      },
    });

    function render(navData) {
      React.render(
        React.createElement(Nav, {data: navData}),
        document.getElementById('navigation_wrap')
      );
    }
    render(navData);
  });
  </script>
</div>

    <div class="navPusher">
      <div class="mainContainer blogContainer postContainer">
  <div id="main_wrap" class="wrapper mainWrapper">
    <div>
</div>
<nav class='toc' id="doc_nav"></nav>
<script>
  var docnavData = [
    
    {
      group     : "Installation",
      items     : [
        
          
        {
          key : "/watchman/docs/install.html",
          title : "Installation",
          url : "/watchman/docs/install.html",
        },
        
          
        {
          key : "/watchman/docs/release-notes.html",
          title : "Release Notes",
          url : "/watchman/docs/release-notes.html",
        }
        
      ],
    },
    
    {
      group     : "Invocation",
      items     : [
        
          
        {
          key : "/watchman/docs/cli-options.html",
          title : "Command Line",
          url : "/watchman/docs/cli-options.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-make.html",
          title : "watchman-make",
          url : "/watchman/docs/watchman-make.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-wait.html",
          title : "watchman-wait",
          url : "/watchman/docs/watchman-wait.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-replicate-subscription.html",
          title : "watchman-replicate-subscription",
          url : "/watchman/docs/watchman-replicate-subscription.html",
        },
        
          
        {
          key : "/watchman/docs/cppclient.html",
          title : "C++ Client",
          url : "/watchman/docs/cppclient.html",
        },
        
          
        {
          key : "/watchman/docs/nodejs.html",
          title : "NodeJS",
          url : "/watchman/docs/nodejs.html",
        },
        
          
        {
          key : "/watchman/docs/config.html",
          title : "Configuration Files",
          url : "/watchman/docs/config.html",
        },
        
          
        {
          key : "/watchman/docs/socket-interface.html",
          title : "Socket Interface",
          url : "/watchman/docs/socket-interface.html",
        }
        
      ],
    },
    
    {
      group     : "Compatibility",
      items     : [
        
          
        {
          key : "/watchman/docs/compatibility.html",
          title : "Compatibility Rules",
          url : "/watchman/docs/compatibility.html",
        },
        
          
        {
          key : "/watchman/docs/capabilities.html",
          title : "Capabilities",
          url : "/watchman/docs/capabilities.html",
        }
        
      ],
    },
    
    {
      group     : "Commands",
      items     : [
        
          
        {
          key : "/watchman/docs/cmd/clock.html",
          title : "clock",
          url : "/watchman/docs/cmd/clock.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/find.html",
          title : "find",
          url : "/watchman/docs/cmd/find.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/flush-subscriptions.html",
          title : "flush-subscriptions",
          url : "/watchman/docs/cmd/flush-subscriptions.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-config.html",
          title : "get-config",
          url : "/watchman/docs/cmd/get-config.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-sockname.html",
          title : "get-sockname",
          url : "/watchman/docs/cmd/get-sockname.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/list-capabilities.html",
          title : "list-capabilities",
          url : "/watchman/docs/cmd/list-capabilities.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log.html",
          title : "log",
          url : "/watchman/docs/cmd/log.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log-level.html",
          title : "log-level",
          url : "/watchman/docs/cmd/log-level.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/query.html",
          title : "query",
          url : "/watchman/docs/cmd/query.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/shutdown-server.html",
          title : "shutdown-server",
          url : "/watchman/docs/cmd/shutdown-server.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/since.html",
          title : "since",
          url : "/watchman/docs/cmd/since.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-enter.html",
          title : "state-enter",
          url : "/watchman/docs/cmd/state-enter.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-leave.html",
          title : "state-leave",
          url : "/watchman/docs/cmd/state-leave.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/subscribe.html",
          title : "subscribe",
          url : "/watchman/docs/cmd/subscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger.html",
          title : "trigger",
          url : "/watchman/docs/cmd/trigger.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-del.html",
          title : "trigger-del",
          url : "/watchman/docs/cmd/trigger-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-list.html",
          title : "trigger-list",
          url : "/watchman/docs/cmd/trigger-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/unsubscribe.html",
          title : "unsubscribe",
          url : "/watchman/docs/cmd/unsubscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/version.html",
          title : "version",
          url : "/watchman/docs/cmd/version.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch.html",
          title : "watch",
          url : "/watchman/docs/cmd/watch.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del.html",
          title : "watch-del",
          url : "/watchman/docs/cmd/watch-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del-all.html",
          title : "watch-del-all",
          url : "/watchman/docs/cmd/watch-del-all.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-list.html",
          title : "watch-list",
          url : "/watchman/docs/cmd/watch-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-project.html",
          title : "watch-project",
          url : "/watchman/docs/cmd/watch-project.html",
        }
        
      ],
    },
    
    {
      group     : "Queries",
      items     : [
        
          
        {
          key : "/watchman/docs/clockspec.html",
          title : "Clockspec",
          url : "/watchman/docs/clockspec.html",
        },
        
          
        {
          key : "/watchman/docs/file-query.html",
          title : "File Queries",
          url : "/watchman/docs/file-query.html",
        },
        
          
        {
          key : "/watchman/docs/simple-query.html",
          title : "Simple Pattern Syntax",
          url : "/watchman/docs/simple-query.html",
        },
        
          
        {
          key : "/watchman/docs/scm-query.html",
          title : "Source Control Aware Queries",
          url : "/watchman/docs/scm-query.html",
        }
        
      ],
    },
    
    {
      group     : "Expression Terms",
      items     : [
        
          
        {
          key : "/watchman/docs/expr/allof.html",
          title : "allof",
          url : "/watchman/docs/expr/allof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/anyof.html",
          title : "anyof",
          url : "/watchman/docs/expr/anyof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/dirname.html",
          title : "dirname & idirname",
          url : "/watchman/docs/expr/dirname.html",
        },
        
          
        {
          key : "/watchman/docs/expr/empty.html",
          title : "empty",
          url : "/watchman/docs/expr/empty.html",
        },
        
          
        {
          key : "/watchman/docs/expr/exists.html",
          title : "exists",
          url : "/watchman/docs/expr/exists.html",
        },
        
          
        {
          key : "/watchman/docs/expr/match.html",
          title : "match & imatch",
          url : "/watchman/docs/expr/match.html",
        },
        
          
        {
          key : "/watchman/docs/expr/name.html",
          title : "name & iname",
          url : "/watchman/docs/expr/name.html",
        },
        
          
        {
          key : "/watchman/docs/expr/not.html",
          title : "not",
          url : "/watchman/docs/expr/not.html",
        },
        
          
        {
          key : "/watchman/docs/expr/pcre.html",
          title : "pcre & ipcre",
          url : "/watchman/docs/expr/pcre.html",
        },
        
          
        {
          key : "/watchman/docs/expr/since.html",
          title : "since",
          url : "/watchman/docs/expr/since.html",
        },
        
          
        {
          key : "/watchman/docs/expr/size.html",
          title : "size",
          url : "/watchman/docs/expr/size.html",
        },
        
          
        {
          key : "/watchman/docs/expr/suffix.html",
          title : "suffix",
          url : "/watchman/docs/expr/suffix.html",
        },
        
          
        {
          key : "/watchman/docs/expr/type.html",
          title : "type",
          url : "/watchman/docs/expr/type.html",
        }
        
      ],
    },
    
    {
      group     : "Internals",
      items     : [
        
          
        {
          key : "/watchman/docs/bser.html",
          title : "BSER Binary Protocol",
          url : "/watchman/docs/bser.html",
        },
        
          
        {
          key : "/watchman/docs/casefolding.html",
          title : "Case-Insensitivity",
          url : "/watchman/docs/casefolding.html",
        },
        
          
        {
          key : "/watchman/contributing.html",
          title : "Contributing",
          url : "/watchman/contributing.html",
        },
        
          
        {
          key : "/watchman/docs/cookies.html",
          title : "Query Synchronization",
          url : "/watchman/docs/cookies.html",
        }
        
      ],
    },
    
    {
      group     : "Troubleshooting",
      items     : [
        
          
        {
          key : "/watchman/docs/troubleshooting.html",
          title : "Troubleshooting",
          url : "/watchman/docs/troubleshooting.html",
        }
        
      ],
    },
    
  ];
</script>
<script type="text/javascript">
window.addEventListener('load', function() {
  var DocNav = React.createClass({displayName: "DocNav",
    getInitialState: function() {
      return {
        toggleActive: false,
      };
    },
    getDefaultProps: function() {
      return {
        currentDoc: "Troubleshooting",
        currentGroup: "Troubleshooting",
        data: docnavData,
      }
    },
    handleSlide: function(id) {
      this.setState({
        toggleActive: !this.state.toggleActive,
      });
    },
    render: function() {
      var classes = React.addons.classSet({
        'navToggle': true,
        'navToggleActive': this.state.toggleActive,
      });
      var navClasses = React.addons.classSet({
        'toggleNav': true,
        'toggleNavActive': this.state.toggleActive,
      });
      return (
        React.createElement("div", {className: navClasses},
          React.createElement("section", null,
            this.props.data.map(this.renderNavGroups)
          ),
          React.createElement("div", {className: classes, onClick: this.handleSlide}, React.createElement("i", {className: "fa fa-chevron-circle-down"}))
        )
      );
    },
    renderNavGroups: function(child, index) {
      var classes = React.addons.classSet({
        'navGroup': true,
        'navGroupActive': this.props.currentGroup === child.group,
      });
      return (
        React.createElement("div", {className: classes, key: index},
          React.createElement("h3", null, child.group),
          React.createElement("ul", null,
            child.items.map(this.renderNavItems)
          )
        )
      );
    },
    renderNavItems: function(child, index) {
      var itemClasses = React.addons.classSet({
        'navListItem': true,
        'navListItemActive': this.props.currentDoc === child.title,
      });
      var classes = React.addons.classSet({
        'navItem': true,
        'navItemActive': this.props.currentDoc === child.title,
      });
      return (
        React.createElement("li", {className: itemClasses, key: index}, React.createElement("a", {className: classes, href: child.url},  child.title))
      );
    },
  });

  function docNavRender(docnavData) {
    React.render(
      React.createElement(DocNav, {data: docnavData}),
      document.getElementById('doc_nav')
    );
  }
  docNavRender(docnavData);
});
</script>

    <div class="post">
  <header class="post-header">
    <h1 class="post-title">Troubleshooting</h1>
  </header>

  <article class="post-content">
   
      <p>We try to give directed advice in Watchman error diagnostics, which means that
we will show a link to a section on this page with some context and advice where
we have enough information to do so.  Some operating systems provide richer
diagnostic information than others, so we have to resort to more generic
advice in some cases.</p>

<p>The most common cause of problems is hitting system resource limits.  There are
finite resources available for filesystem watching, and when they are exceeded
it can impact performance in the best case or prohibit correct operation in the
worst case.</p>

<h2 id="ensure-that-you-are-on-the-best-available-version">Ensure that you are on the best available version</h2>

<p>It is generally a good idea to make sure that you are using the latest
version of the software, so that you avoid any known issues.</p>

<p>If you are running a pre-built binary provided by your operating system
distribution system, there is a chance that you’ll need to build the
latest version from source.  You can find instructions for this in
<a href="/watchman/docs/install.html">the installation section</a>.</p>

<h2 id="recrawl">Recrawl</h2>

<p>A recrawl is an action that Watchman performs in order to recover from
situations where it believes that it has lost sync with the state of the
filesystem.</p>

<p>The most common cause for a recrawl is on Linux systems where the default
inotify limits are sized quite small.  What this means is that the rate at
which your watched roots are generating changes is higher than the kernel can
buffer and relay to the watchman service.  When this happens, the kernel
detects the overflow and signals <code class="language-plaintext highlighter-rouge">IN_Q_OVERFLOW</code>.  The recovery is to
recursively scan the root to make sure that we know what is really there and
re-sync with the notification stream.</p>

<p>Frequent recrawls are undesirable because they result in a potentially
expensive full tree crawl, which marks all files as changed and propagates this
status to clients which will in turn perform some action on the (likely
falsely) changed state of the majority of files.</p>

<h3 id="avoiding-recrawls">Avoiding Recrawls</h3>

<p>There is no simple formula for setting your system limits; bigger is better but
comes at the cost of kernel memory to maintain the buffers.  You and/or your
system administrator should review the workload for your system and the
<a href="/watchman/docs/install.html#system-specific-preparation">System Specific Preparation Documentation</a> and raise your limits
accordingly.</p>

<h3 id="kfseventstreameventflaguserdropped">kFSEventStreamEventFlagUserDropped</h3>

<p>macOS has a similar internal limit and behavior when that limit is exceeded.
If you’re encountering a message like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>Recrawled this watch 1 times, most recently because:
/some/path: kFSEventStreamEventFlagUserDropped
</pre></td></tr></tbody></table></code></pre></div></div>

<p>then you are hitting the limits of your system.  There is no direct control
over the limit, but starting in Watchman 3.2 you may increase the
<a href="/watchman/docs/config.html#fsevents-latency">fsevents_latency</a>
parameter in your <code class="language-plaintext highlighter-rouge">.watchmanconfig</code> file.</p>

<h3 id="ive-changed-my-limits-how-can-i-clear-the-warning">I’ve changed my limits, how can I clear the warning?</h3>

<p>The warning will stick until you cancel the watch and reinstate it, or restart
the watchman process.  The simplest resolution is to run <code class="language-plaintext highlighter-rouge">watchman
shutdown-server</code> and re-establish your watch on your next watchman query.</p>

<h2 id="where-are-the-logs">Where are the logs?</h2>

<p>Watchman places logs in a file named <code class="language-plaintext highlighter-rouge">&lt;STATEDIR&gt;/&lt;USER&gt;.log</code>, where <code class="language-plaintext highlighter-rouge">STATEDIR</code>
is set at the time that you built watchman.</p>

<p>If you used the <code class="language-plaintext highlighter-rouge">--enable-statedir=&lt;STATEDIR&gt;</code> configure option, that will
be the location that holds your logs.  If not, the default for <code class="language-plaintext highlighter-rouge">STATEDIR</code>
will be <code class="language-plaintext highlighter-rouge">&lt;PREFIX&gt;/var/run/watchman</code>, or for older versions of watchman,
the logs may be placed in <code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;/.watchman.&lt;USER&gt;.log</code>.</p>

<p><em>Since 3.8.</em></p>

<p>Watchman places the logs in a file named <code class="language-plaintext highlighter-rouge">&lt;STATEDIR&gt;/log</code>, which will
typically be a location like <code class="language-plaintext highlighter-rouge">&lt;PREFIX&gt;/var/run/watchman/&lt;USER&gt;-state/log</code>. If
you’re running a <code class="language-plaintext highlighter-rouge">homebrew</code> build of watchman, <code class="language-plaintext highlighter-rouge">&lt;PREFIX&gt;</code> is usually <code class="language-plaintext highlighter-rouge">/usr/local</code>.</p>

<p>The default log location may be overridden by the <code class="language-plaintext highlighter-rouge">--logfile</code> <a href="/watchman/docs/cli-options.html#server-options">Server Option</a>.</p>

<p><a href="/watchman/docs/cli-options.html#quick-note-on-default-locations">Quick note on default locations</a> explains what
we mean by <code class="language-plaintext highlighter-rouge">&lt;STATEDIR&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;TMPDIR&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;USER&gt;</code> and so on.</p>

<h2 id="poison-inotify_add_watch"><a id="poison-inotify-add-watch"></a>Poison: inotify_add_watch</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>A non-recoverable condition has triggered.  Watchman needs your help!
The triggering condition was at timestamp=1407695600: inotify-add-watch(/my/path) -&gt; Cannot allocate memory
All requests will continue to fail with this message until you resolve
the underlying problem.  You will find more information on fixing this at
https://facebook.github.io/watchman/docs/troubleshooting.html#poison-inotify-add-watch
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you’ve encountered this state it means that your <em>kernel</em> was unable to
watch a dir in one or more of the roots you’ve asked it to watch.  This
particular condition is considered non-recoverable by Watchman on the basis
that nothing that the Watchman service can do can guarantee that the root cause
is resolved, and while the system is in this state, Watchman cannot guarantee
that it can respond with the correct results that its clients depend upon.  We
consider ourselves poisoned and will fail all requests for all watches (not
just the watch that it triggered on) until the process is restarted.</p>

<p>There are two primary reasons that this can trigger:</p>

<ul>
  <li>The user limit on the total number of inotify watches was reached or the
kernel failed to allocate a needed resource</li>
  <li>Insufficient kernel memory was available</li>
</ul>

<p>The resolution for the former is to revisit
<a href="/watchman/docs/install.html#system-specific-preparation">System Specific Preparation Documentation</a> and raise your limits
accordingly.</p>

<p>The latter condition implies that your workload is exceeding the available RAM
on the machine.  It is difficult to give specific advice to resolve this
condition here; you may be able to tune down other system limits to free up
some resources, or you may just need to install more RAM in the system.</p>

<h3 id="ive-changed-my-limits-how-can-i-clear-the-error">I’ve changed my limits, how can I clear the error?</h3>

<p>The error will stick until you restart the watchman process.  The simplest
resolution is:</p>

<p><em>Since 4.6</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ watchman watch-del-all
$ watchman shutdown-server
</pre></td></tr></tbody></table></code></pre></div></div>

<p><em>Before 4.6</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ rm &lt;STATEDIR&gt;/state       # see above for what STATEDIR means
$ watchman --no-spawn --no-local shutdown-server
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you have not actually resolved the root cause you may continue to trigger
and experience this state each time the system trips over these limits.</p>

<h2 id="poison-opendir">Poison: opendir</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>A non-recoverable condition has triggered.  Watchman needs your help!
The triggering condition was at timestamp=1407695600: opendir(/my/path) -&gt; Too many open files in system
All requests will continue to fail with this message until you resolve
the underlying problem.  You will find more information on fixing this at
https://facebook.github.io/watchman/docs/troubleshooting.html#opendir
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you’ve encountered this state it means that your entire system had too many
open files, and that this prevented watchman from tracking the changes on your
system.  In this case, the error isn’t related to filesystem watching but to
other (likely) misbehaving processes on your system; it’s usually indicative of
a runaway program or set of programs consuming resources, but in some cases it
may just be that your system workload requires that you increase your system
limits for the number of files.</p>

<h3 id="how-do-i-resolve-this">How do I resolve this?</h3>

<p><a href="/watchman/docs/troubleshooting.html#i-39-ve-changed-my-limits-how-can-i-clear-the-error">Follow these directions</a></p>

<p>If the issue persists, consult your system administrator to identify what
is consuming these resources and remediate it, or to increase your system
limits.</p>

<h2 id="fsevents">FSEvents</h2>

<p>FSEvents is the file watching facility on macOS.  There are few diagnostics
that can help diagnose issues with FSEvents; the API itself gives little
feedback on a number of error cases and instead emits rather cryptic error
messages to the log file.</p>

<p>If you got here because an error message told you to read this section,
it will have also asked you to look at your log file.  If you are using an
older version of watchman and encounter the error message
<code class="language-plaintext highlighter-rouge">FSEventStreamStart failed</code>, then you should locate your log file (see
<a href="#where-are-the-logs">Where are the logs?</a> above) and look for lines
that mention FSEvents and then consult the information below.</p>

<h3 id="fseventstreamstart-register_with_server-error-f2d_register_rpc--null--21">FSEventStreamStart: register_with_server: ERROR: f2d_register_rpc() =&gt; (null) (-21)</h3>

<p>Nobody outside of Apple is sure what precisely this means, but it indicates
that the fsevents service has gotten in a bad state.  Possible reasons for
this may include:</p>

<ul>
  <li>There are too many event stream clients</li>
  <li>One or more event stream clients has gotten in a bad state and is somehow
impacting the fsevents service</li>
</ul>

<p>To resolve this issue, you may wish to try the following, which are
progressively more invasive:</p>

<ul>
  <li>Avoid establishing multiple overlapping watches within the same filesystem
tree, especially for large trees.  We recommend watching only the root of a
project or repo and not watching sub-trees within that tree.  Organizations
with large trees may wish to deploy the
<a href="config.html#root-restrict-files">root_restrict_files</a> configuration option
so that watchman will only allow watching project roots.</li>
  <li>Close or restart other applications that are using fsevents.
Some examples are:</li>
  <li>editors such as Sublime Text and TextMate.</li>
  <li>Many nodejs packages and Grunt style workflows make use of fsevents.
Make sure that you upgrade nodejs to at least version <code class="language-plaintext highlighter-rouge">v0.11.14</code>.  If
possible, configure your nodejs packages to use either
<a href="https://www.npmjs.com/package/sane">sane</a> or
<a href="https://www.npmjs.com/package/fb-watchman">fb-watchman</a> for file watching
as this will consolidate the number of fsevents watches down to just the
set maintained by watchman.</li>
  <li>Restart the fsevents service: <code class="language-plaintext highlighter-rouge">sudo pkill -9 -x fseventsd</code></li>
  <li>Restart your computer</li>
</ul>

<h2 id="triggerssubscriptions-dont-fire-on-macos">Triggers/Subscriptions don’t fire on macOS</h2>

<p>There is a rare fsevents bug that can prevent any notifications from working
in directories where the case of the name of a directory in the kernel has
an inconsistency.</p>

<p>You can test whether this is happening to you by following <a href="https://github.com/andreyvit/find-fsevents-bugs">the instructions
for the find-fsevents-bugs tool</a>.</p>

<p>If it is happening to you, the resolution is to rename the directories
highlighted by the tool.</p>

<p>You can read more about this issue in the following resources:</p>

<ul>
  <li><a href="http://feedback.livereload.com/knowledgebase/articles/86239-os-x-fsevents-bug-may-prevent-monitoring-of-certai">Knowledge base article for LiveReload</a></li>
  <li><a href="https://github.com/thibaudgg/rb-fsevent/issues/10">issue for the Ruby fsevents module</a></li>
  <li><a href="http://openradar.appspot.com/10207999">Open Radar bug report</a></li>
</ul>

<h2 id="reactnative-watcher-took-too-long-to-load">ReactNative: Watcher took too long to load</h2>

<p>There was an issue that was the result of umask affecting the permissions of
the launchd plist file that Watchman uses to set up your watchman service on OS
X.  This issue was resolved in Watchman version 3.1.</p>

<p>To update:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>watchman shutdown-server
brew update
brew reinstall watchman
</pre></td></tr></tbody></table></code></pre></div></div>

    
  </article>
</div>

  </div>
</div>


      <div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <section id="fb_oss" class="fbOpenSourceFooter">
      <a href="https://code.facebook.com/projects/" target="_blank"><img src="/watchman/static/oss_logo.png" alt="Facebook Open Source" title="Facebook Open Source" /></a>
    </section>
  </div>
</div>
<script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = window.location.href.replace(window.location.hash, '') + "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  window.addEventListener('load', function() {
    var contentBlock = document.getElementsByClassName("post")[0] || document.getElementsByClassName("news")[0];
    if (!contentBlock) {
      return;
    }
    for (var level = 1; level <= 6; level++) {
      linkifyAnchors(level, contentBlock);
    }
  });
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44373548-13', 'auto');
  ga('send', 'pageview');
</script>
<script>
  window.addEventListener('load', function() {
    hljs.initHighlightingOnLoad();

    // Async load some styles
    function loadStyle(href) {
      var s = document.createElement('link');
      s.setAttribute('rel', 'stylesheet');
      s.setAttribute('href', href);
      s.setAttribute('type', 'text/css');
      document.getElementsByTagName('head')[0].appendChild(s);
    }
    loadStyle("//nuclide.io/static/fonts/332720/BC699FA675F9356E3.css");
    loadStyle("//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css");
    loadStyle("//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css");
  });
</script>

    </div>
  </body>

</html>
