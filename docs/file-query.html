<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>File Queries | Watchman</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="File Queries" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Watchman file queries consist of 1 or more generators that feed files through the expression evaluator." />
<meta property="og:description" content="Watchman file queries consist of 1 or more generators that feed files through the expression evaluator." />
<link rel="canonical" href="https://facebook.github.io/watchman/docs/file-query.html" />
<meta property="og:url" content="https://facebook.github.io/watchman/docs/file-query.html" />
<meta property="og:site_name" content="Watchman" />
<meta property="og:image" content="https://facebook.github.io/watchman/static/og_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-03T15:40:25+00:00" />
<script type="application/ld+json">
{"headline":"File Queries","url":"https://facebook.github.io/watchman/docs/file-query.html","dateModified":"2020-12-03T15:40:25+00:00","datePublished":"2020-12-03T15:40:25+00:00","description":"Watchman file queries consist of 1 or more generators that feed files through the expression evaluator.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://facebook.github.io/watchman/static/logo.png"}},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://facebook.github.io/watchman/docs/file-query.html"},"image":"https://facebook.github.io/watchman/static/og_image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" type="text/css" media="screen" href="/watchman/css/main.css">
  <link rel="icon" href="static/favicon.png" type="image/x-icon">

  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.min.js"></script>
  <script async defer src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>

  
  <link type="application/atom+xml" rel="alternate" href="https://facebook.github.io/watchman/feed.xml" title="Watchman" />
</head>

  <body>    
    <div id="fixed_header" class="fixedHeaderContainer visible">
  <header>
    <a href="https://facebook.github.io/watchman/"><img src="/watchman/static/logo.png" /><h2>Watchman</h2></a>
    <div class="navigationWrapper navigationFull" id="flat_nav">
      <nav class="navigation">
        <ul>
          
          <li class="navItem navItemActive">
            <a href=/watchman/docs/install.html>Docs</a>
          </li>
          
          <li class="navItem ">
            <a href=/watchman/support.html>Support</a>
          </li>
          
          <li class="navItem ">
            <a href=http://github.com/facebook/watchman>GitHub</a>
          </li>
          
        </ul>
      </nav>
    </div>
    <div class="navigationWrapper navigationSlider" id="navigation_wrap"></div>
  </header>
  <script>
    var event = document.createEvent('Event');
    event.initEvent('slide', true, true);
    document.addEventListener('slide', function (e) {
      document.body.classList.toggle('sliderActive');
    }, false);
    var navData = [
      
      {
        href       : "/watchman/docs/install.html",
        text       : "Docs",
      },
      
      {
        href       : "/watchman/support.html",
        text       : "Support",
      },
      
      {
        href       : "http://github.com/facebook/watchman",
        text       : "GitHub",
      },
      
    ];
  </script>
  <script type="text/javascript">  
  window.addEventListener('load', function() {
    var Nav = React.createClass({displayName: "Nav",
      getInitialState: function() {
        return {
          currentPath: window.location.pathname,
          slideoutActive: false,
        };
      },
      getDefaultProps: function() {
        return {
          data: navData,
        }
      },
      handleClick: function(id) {
        this.setState({
          slideoutActive: false,
        });
        document.dispatchEvent(event);
      },
      handleSlide: function(id) {
        this.setState({
          slideoutActive: !this.state.slideoutActive,
        });
        document.dispatchEvent(event);
      },
      render: function() {
        var classes = React.addons.classSet({
          'navSlideout': true,
          'navSlideoutActive': this.state.slideoutActive,
        });
        var navClasses = React.addons.classSet({
          'slidingNav': true,
          'slidingNavActive': this.state.slideoutActive,
        });
        return (
          React.createElement("div", null, 
            React.createElement("div", {className: classes, onClick: this.handleSlide}, 
              React.createElement("i", {className: "fa fa-bars"})
            ), 
            React.createElement("nav", {className: navClasses}, 
              React.createElement("ul", null, 
                this.props.data.map(this.renderNavItems)
              )
            )
          )
        );
      },
      renderNavItems: function(child, index) {
        var classes = React.addons.classSet({
          'navItem': true,
          'navItemActive': this.state.currentPath === child.href,
        });
        return (
          React.createElement("li", {key: index, className: classes}, 
            React.createElement("a", {onClick: this.handleClick, href: child.href}, child.text)
          )
        );
      },
    });

    function render(navData) {
      React.render(
        React.createElement(Nav, {data: navData}),
        document.getElementById('navigation_wrap')
      );
    }
    render(navData);
  });
  </script>
</div>

    <div class="navPusher">
      <div class="mainContainer blogContainer postContainer">
  <div id="main_wrap" class="wrapper mainWrapper">
    <div>
</div>
<nav class='toc' id="doc_nav"></nav>
<script>
  var docnavData = [
    
    {
      group     : "Installation",
      items     : [
        
          
        {
          key : "/watchman/docs/install.html",
          title : "Installation",
          url : "/watchman/docs/install.html",
        },
        
          
        {
          key : "/watchman/docs/release-notes.html",
          title : "Release Notes",
          url : "/watchman/docs/release-notes.html",
        }
        
      ],
    },
    
    {
      group     : "Invocation",
      items     : [
        
          
        {
          key : "/watchman/docs/cli-options.html",
          title : "Command Line",
          url : "/watchman/docs/cli-options.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-make.html",
          title : "watchman-make",
          url : "/watchman/docs/watchman-make.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-wait.html",
          title : "watchman-wait",
          url : "/watchman/docs/watchman-wait.html",
        },
        
          
        {
          key : "/watchman/docs/watchman-replicate-subscription.html",
          title : "watchman-replicate-subscription",
          url : "/watchman/docs/watchman-replicate-subscription.html",
        },
        
          
        {
          key : "/watchman/docs/cppclient.html",
          title : "C++ Client",
          url : "/watchman/docs/cppclient.html",
        },
        
          
        {
          key : "/watchman/docs/nodejs.html",
          title : "NodeJS",
          url : "/watchman/docs/nodejs.html",
        },
        
          
        {
          key : "/watchman/docs/config.html",
          title : "Configuration Files",
          url : "/watchman/docs/config.html",
        },
        
          
        {
          key : "/watchman/docs/socket-interface.html",
          title : "Socket Interface",
          url : "/watchman/docs/socket-interface.html",
        }
        
      ],
    },
    
    {
      group     : "Compatibility",
      items     : [
        
          
        {
          key : "/watchman/docs/compatibility.html",
          title : "Compatibility Rules",
          url : "/watchman/docs/compatibility.html",
        },
        
          
        {
          key : "/watchman/docs/capabilities.html",
          title : "Capabilities",
          url : "/watchman/docs/capabilities.html",
        }
        
      ],
    },
    
    {
      group     : "Commands",
      items     : [
        
          
        {
          key : "/watchman/docs/cmd/clock.html",
          title : "clock",
          url : "/watchman/docs/cmd/clock.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/find.html",
          title : "find",
          url : "/watchman/docs/cmd/find.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/flush-subscriptions.html",
          title : "flush-subscriptions",
          url : "/watchman/docs/cmd/flush-subscriptions.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-config.html",
          title : "get-config",
          url : "/watchman/docs/cmd/get-config.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/get-sockname.html",
          title : "get-sockname",
          url : "/watchman/docs/cmd/get-sockname.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/list-capabilities.html",
          title : "list-capabilities",
          url : "/watchman/docs/cmd/list-capabilities.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log.html",
          title : "log",
          url : "/watchman/docs/cmd/log.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/log-level.html",
          title : "log-level",
          url : "/watchman/docs/cmd/log-level.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/query.html",
          title : "query",
          url : "/watchman/docs/cmd/query.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/shutdown-server.html",
          title : "shutdown-server",
          url : "/watchman/docs/cmd/shutdown-server.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/since.html",
          title : "since",
          url : "/watchman/docs/cmd/since.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-enter.html",
          title : "state-enter",
          url : "/watchman/docs/cmd/state-enter.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/state-leave.html",
          title : "state-leave",
          url : "/watchman/docs/cmd/state-leave.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/subscribe.html",
          title : "subscribe",
          url : "/watchman/docs/cmd/subscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger.html",
          title : "trigger",
          url : "/watchman/docs/cmd/trigger.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-del.html",
          title : "trigger-del",
          url : "/watchman/docs/cmd/trigger-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/trigger-list.html",
          title : "trigger-list",
          url : "/watchman/docs/cmd/trigger-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/unsubscribe.html",
          title : "unsubscribe",
          url : "/watchman/docs/cmd/unsubscribe.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/version.html",
          title : "version",
          url : "/watchman/docs/cmd/version.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch.html",
          title : "watch",
          url : "/watchman/docs/cmd/watch.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del.html",
          title : "watch-del",
          url : "/watchman/docs/cmd/watch-del.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-del-all.html",
          title : "watch-del-all",
          url : "/watchman/docs/cmd/watch-del-all.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-list.html",
          title : "watch-list",
          url : "/watchman/docs/cmd/watch-list.html",
        },
        
          
        {
          key : "/watchman/docs/cmd/watch-project.html",
          title : "watch-project",
          url : "/watchman/docs/cmd/watch-project.html",
        }
        
      ],
    },
    
    {
      group     : "Queries",
      items     : [
        
          
        {
          key : "/watchman/docs/clockspec.html",
          title : "Clockspec",
          url : "/watchman/docs/clockspec.html",
        },
        
          
        {
          key : "/watchman/docs/file-query.html",
          title : "File Queries",
          url : "/watchman/docs/file-query.html",
        },
        
          
        {
          key : "/watchman/docs/simple-query.html",
          title : "Simple Pattern Syntax",
          url : "/watchman/docs/simple-query.html",
        },
        
          
        {
          key : "/watchman/docs/scm-query.html",
          title : "Source Control Aware Queries",
          url : "/watchman/docs/scm-query.html",
        }
        
      ],
    },
    
    {
      group     : "Expression Terms",
      items     : [
        
          
        {
          key : "/watchman/docs/expr/allof.html",
          title : "allof",
          url : "/watchman/docs/expr/allof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/anyof.html",
          title : "anyof",
          url : "/watchman/docs/expr/anyof.html",
        },
        
          
        {
          key : "/watchman/docs/expr/dirname.html",
          title : "dirname & idirname",
          url : "/watchman/docs/expr/dirname.html",
        },
        
          
        {
          key : "/watchman/docs/expr/empty.html",
          title : "empty",
          url : "/watchman/docs/expr/empty.html",
        },
        
          
        {
          key : "/watchman/docs/expr/exists.html",
          title : "exists",
          url : "/watchman/docs/expr/exists.html",
        },
        
          
        {
          key : "/watchman/docs/expr/match.html",
          title : "match & imatch",
          url : "/watchman/docs/expr/match.html",
        },
        
          
        {
          key : "/watchman/docs/expr/name.html",
          title : "name & iname",
          url : "/watchman/docs/expr/name.html",
        },
        
          
        {
          key : "/watchman/docs/expr/not.html",
          title : "not",
          url : "/watchman/docs/expr/not.html",
        },
        
          
        {
          key : "/watchman/docs/expr/pcre.html",
          title : "pcre & ipcre",
          url : "/watchman/docs/expr/pcre.html",
        },
        
          
        {
          key : "/watchman/docs/expr/since.html",
          title : "since",
          url : "/watchman/docs/expr/since.html",
        },
        
          
        {
          key : "/watchman/docs/expr/size.html",
          title : "size",
          url : "/watchman/docs/expr/size.html",
        },
        
          
        {
          key : "/watchman/docs/expr/suffix.html",
          title : "suffix",
          url : "/watchman/docs/expr/suffix.html",
        },
        
          
        {
          key : "/watchman/docs/expr/type.html",
          title : "type",
          url : "/watchman/docs/expr/type.html",
        }
        
      ],
    },
    
    {
      group     : "Internals",
      items     : [
        
          
        {
          key : "/watchman/docs/bser.html",
          title : "BSER Binary Protocol",
          url : "/watchman/docs/bser.html",
        },
        
          
        {
          key : "/watchman/docs/casefolding.html",
          title : "Case-Insensitivity",
          url : "/watchman/docs/casefolding.html",
        },
        
          
        {
          key : "/watchman/contributing.html",
          title : "Contributing",
          url : "/watchman/contributing.html",
        },
        
          
        {
          key : "/watchman/docs/cookies.html",
          title : "Query Synchronization",
          url : "/watchman/docs/cookies.html",
        }
        
      ],
    },
    
    {
      group     : "Troubleshooting",
      items     : [
        
          
        {
          key : "/watchman/docs/troubleshooting.html",
          title : "Troubleshooting",
          url : "/watchman/docs/troubleshooting.html",
        }
        
      ],
    },
    
  ];
</script>
<script type="text/javascript">
window.addEventListener('load', function() {
  var DocNav = React.createClass({displayName: "DocNav",
    getInitialState: function() {
      return {
        toggleActive: false,
      };
    },
    getDefaultProps: function() {
      return {
        currentDoc: "File Queries",
        currentGroup: "Queries",
        data: docnavData,
      }
    },
    handleSlide: function(id) {
      this.setState({
        toggleActive: !this.state.toggleActive,
      });
    },
    render: function() {
      var classes = React.addons.classSet({
        'navToggle': true,
        'navToggleActive': this.state.toggleActive,
      });
      var navClasses = React.addons.classSet({
        'toggleNav': true,
        'toggleNavActive': this.state.toggleActive,
      });
      return (
        React.createElement("div", {className: navClasses},
          React.createElement("section", null,
            this.props.data.map(this.renderNavGroups)
          ),
          React.createElement("div", {className: classes, onClick: this.handleSlide}, React.createElement("i", {className: "fa fa-chevron-circle-down"}))
        )
      );
    },
    renderNavGroups: function(child, index) {
      var classes = React.addons.classSet({
        'navGroup': true,
        'navGroupActive': this.props.currentGroup === child.group,
      });
      return (
        React.createElement("div", {className: classes, key: index},
          React.createElement("h3", null, child.group),
          React.createElement("ul", null,
            child.items.map(this.renderNavItems)
          )
        )
      );
    },
    renderNavItems: function(child, index) {
      var itemClasses = React.addons.classSet({
        'navListItem': true,
        'navListItemActive': this.props.currentDoc === child.title,
      });
      var classes = React.addons.classSet({
        'navItem': true,
        'navItemActive': this.props.currentDoc === child.title,
      });
      return (
        React.createElement("li", {className: itemClasses, key: index}, React.createElement("a", {className: classes, href: child.url},  child.title))
      );
    },
  });

  function docNavRender(docnavData) {
    React.render(
      React.createElement(DocNav, {data: docnavData}),
      document.getElementById('doc_nav')
    );
  }
  docNavRender(docnavData);
});
</script>

    <div class="post">
  <header class="post-header">
    <h1 class="post-title">File Queries</h1>
  </header>

  <article class="post-content">
   
      <p>Watchman file queries consist of 1 or more <em>generators</em> that feed files through
the <em>expression evaluator</em>.</p>

<h3 id="generators">Generators</h3>

<p>Generators are analogous to the list of <em>paths</em> that you specify when using the
<code class="language-plaintext highlighter-rouge">find(1)</code> utility, but are implemented in watchman with a bit of a twist
because watchman doesn’t need to crawl the filesystem in realtime and instead
maintains a couple of indexes over the tree.</p>

<p>A query may specify any number of generators; each generator will emit its list
of files and this may mean that you see the same file output more than once if
you specified the use of multiple generators that all produce the same file.</p>

<p>Watchman provides 5 generators:</p>

<ul>
  <li><strong>since</strong>: produces a list of files that were modified since a specific
clockspec.</li>
  <li><strong>suffix</strong>: produces a list of files that have a particular suffix.</li>
  <li><strong>glob</strong>: efficiently pattern match a list of files based on their names.</li>
  <li><strong>path</strong>: produces a list of files based on their path and depth.</li>
  <li><strong>all</strong>: produces a list of all known files</li>
</ul>

<h3 id="de-duplicating-results">De-duplicating results</h3>

<p><em>Since 4.7.</em></p>

<p>If your query uses multiple generators, or configures the <code class="language-plaintext highlighter-rouge">path</code> generator with
paths that yield multiple results, the default behavior (for backwards
compatibility reasons) is to emit those duplicate results in the query output.</p>

<p>You may ask Watchman to de-duplicate results for you by enabling the
<code class="language-plaintext highlighter-rouge">dedup_results</code> boolean in your query:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>$ watchman -j &lt;&lt;-EOT
["query", "/path/to/root", {
  "path": ["bar", "bar"],
  "dedup_results": true
}]
EOT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You may test for this feature using an extended version command and requesting
the capability name <code class="language-plaintext highlighter-rouge">dedup_results</code>.</p>

<h3 id="since-generator">Since Generator</h3>

<p>The <code class="language-plaintext highlighter-rouge">since</code> generator produces a list of files that were modified since a
specific <a href="../docs/clockspec.html">clockspec</a>.</p>

<p>The following query will consider the set of files changed since the last
query using the named cursor <code class="language-plaintext highlighter-rouge">mycursor</code> and then pass them to the expression
evaluator to be filtered to just those that are files:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">-j</span> <span class="o">&lt;&lt;-</span><span class="no">EOT</span><span class="sh">
["query", "/path/to/root", {
  "since": "n:mycursor",
  "expression": ["type", "f"]
}]
</span><span class="no">EOT
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>If the <code class="language-plaintext highlighter-rouge">since</code> parameter value is blank, was produced by a different watchman
process (in other words, the watchman process was restarted between the time
that the value was obtained and the time the query was issued) or is a named
cursor that has not yet been used in a query, the <code class="language-plaintext highlighter-rouge">since</code> generator will
consider the state to be a <em>fresh instance</em> and its behavior is modified:</p>

<p>A <em>fresh instance</em> result set will only include files that currently exist
and will generate file nodes that are always considered to be <code class="language-plaintext highlighter-rouge">new</code>.</p>

<p>If the query was configured with the <code class="language-plaintext highlighter-rouge">empty_on_fresh_instance</code> property set to
<code class="language-plaintext highlighter-rouge">true</code> then the result set will be empty and the <code class="language-plaintext highlighter-rouge">is_fresh_instance</code> property
will be set to <code class="language-plaintext highlighter-rouge">true</code> in the result object.</p>

<p>The since generator also knows how to talk to source control;
<a href="/watchman/docs/scm-query.html">you can read more about that here</a>.</p>

<p>The <code class="language-plaintext highlighter-rouge">since</code> generator does not consider the targets of symlinks. In particular,
the <code class="language-plaintext highlighter-rouge">since</code> generator may <em>not</em> produce a symlink in the following cases:</p>

<ul>
  <li>The symlink’s target was a file, and the file is since modified.</li>
  <li>The symlink’s target was a file, and the file is since deleted or replaced
with a different file.</li>
  <li>An ancestor of the symlink’s target was created or deleted or modified.</li>
  <li>The symlink’s target was a directory, and a file is since added or removed
from that directory.</li>
</ul>

<h3 id="suffix-generator">Suffix Generator</h3>

<p>The <code class="language-plaintext highlighter-rouge">suffix</code> generator produces a list of files that have a particular suffix
or set of suffixes.  The value can be either a string or an array of strings.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">-j</span> <span class="o">&lt;&lt;-</span><span class="no">EOT</span><span class="sh">
["query", "/path/to/root", {
  "suffix": "js"
}]
</span><span class="no">EOT
</span></pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">-j</span> <span class="o">&lt;&lt;-</span><span class="no">EOT</span><span class="sh">
["query", "/path/to/root", {
  "suffix": ["js", "css"]
}]
</span><span class="no">EOT
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>If the <code class="language-plaintext highlighter-rouge">suffix</code> generator is given an empty array, it produces no files.</p>

<p>The <code class="language-plaintext highlighter-rouge">suffix</code> generator can produce symlinks.</p>

<p>The <code class="language-plaintext highlighter-rouge">suffix</code> generator does not follow symlinks. For example, a symlink to
<code class="language-plaintext highlighter-rouge">/etc</code> will not cause a <code class="language-plaintext highlighter-rouge">"suffix": "conf"</code> query to search within <code class="language-plaintext highlighter-rouge">/etc</code> and
produce <code class="language-plaintext highlighter-rouge">/etc/resolv.conf</code>.</p>

<h3 id="glob-generator">Glob Generator</h3>

<p><em>Since 4.7.</em></p>

<p>The <code class="language-plaintext highlighter-rouge">glob</code> generator produces a list of files by matching against your
input list of patterns.  It does this by building a tree from the glob
expression(s) and walking both the expression and the in-memory filesystem
tree concurrently.</p>

<p>This query will yield a list of all of the C source and header files found
directly in the <code class="language-plaintext highlighter-rouge">src</code> dir:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>$ watchman -j &lt;&lt;-EOT
["query", "/path/to/root", {
  "glob": ["src/*.c", "src/*.h"],
  "fields": ["name"]
}]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This query will yield a list of all of the C source and header files found
in any subdirectories of the root:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>$ watchman -j &lt;&lt;-EOT
["query", "/path/to/root", {
  "glob": ["**/*.c", "**/*.h"],
  "fields": ["name"]
}]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note that it is more efficient to use the <code class="language-plaintext highlighter-rouge">suffix</code> generator together with a
<code class="language-plaintext highlighter-rouge">dirname</code> expression term for such a broadly scoped query as it results in
fewer comparisons.  This example is included as an illustration of recursive
globbing.</p>

<p>The glob generator implicitly enables <code class="language-plaintext highlighter-rouge">dedup_results</code> mode.</p>

<p>If the <code class="language-plaintext highlighter-rouge">glob</code> generator is given an empty array, it produces no files.</p>

<p>The <code class="language-plaintext highlighter-rouge">glob</code> generator can produce symlinks.</p>

<p>The <code class="language-plaintext highlighter-rouge">glob</code> generator does not follow symlinks. For example, a symlink to <code class="language-plaintext highlighter-rouge">/etc</code>
will not cause a <code class="language-plaintext highlighter-rouge">"glob": ["**/resolv.conf"]</code> query to search within <code class="language-plaintext highlighter-rouge">/etc</code> and
produce <code class="language-plaintext highlighter-rouge">/etc/resolv.conf</code>.</p>

<h3 id="path-generator">Path Generator</h3>

<p>The <code class="language-plaintext highlighter-rouge">path</code> generator produces a list of files based on their path and depth.
Depth controls how far watchman will search down the directory tree for files.</p>

<p>The <code class="language-plaintext highlighter-rouge">path</code> generator expects an array of path specifiers.  Each path specifier
can be either a string or an object and each will produce a set of files.</p>

<p>If it is a string then it is treated as the value for <code class="language-plaintext highlighter-rouge">path</code> with <code class="language-plaintext highlighter-rouge">depth</code> set
to infinite.  If an object, the fields <code class="language-plaintext highlighter-rouge">path</code> (a string) and <code class="language-plaintext highlighter-rouge">depth</code> (an
integer) must be supplied.</p>

<p>Paths are relative to the root, so if watchman is watching <code class="language-plaintext highlighter-rouge">/foo/</code>, path <code class="language-plaintext highlighter-rouge">bar</code>
refers to <code class="language-plaintext highlighter-rouge">/foo/bar</code>.</p>

<p>A <code class="language-plaintext highlighter-rouge">depth</code> value of <code class="language-plaintext highlighter-rouge">0</code> means only files and directories which are contained in
this path.  A <code class="language-plaintext highlighter-rouge">depth</code> value of <code class="language-plaintext highlighter-rouge">-1</code> means no limit on the depth.</p>

<p>The following <code class="language-plaintext highlighter-rouge">path</code> generators are equivalent:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>$ watchman -j &lt;&lt;-EOT
["query", "/path/to/root", {
  "path": ["bar"]
}]
EOT
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>$ watchman -j &lt;&lt;-EOT
["query", "/path/to/root", {
  "path": [{"path": "bar", "depth": -1}]
}]
EOT
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If the <code class="language-plaintext highlighter-rouge">path</code> generator is given an empty array, it produces no files.</p>

<p>The <code class="language-plaintext highlighter-rouge">path</code> generator can produce symlinks.</p>

<p>The <code class="language-plaintext highlighter-rouge">path</code> generator does not follow symlinks.</p>

<h3 id="all-generator">All Generator</h3>

<p>The <code class="language-plaintext highlighter-rouge">all</code> generator produces a list of all file nodes.  It is the default
generator and is used in the case where no other generators were explicitly
specified.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>watchman <span class="nt">-j</span> <span class="o">&lt;&lt;-</span><span class="no">EOT</span><span class="sh">
["query", "/path/to/root", {
}]
</span><span class="no">EOT
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">all</code> generator can produce symlinks.</p>

<p>The <code class="language-plaintext highlighter-rouge">all</code> generator does not follow symlinks.</p>

<h3 id="expressions">Expressions</h3>

<p>A watchman query expression consists of 0 or more expression terms.  If no
terms are provided then each file evaluated is considered a match (equivalent
to specifying a single <code class="language-plaintext highlighter-rouge">true</code> expression term).</p>

<p>Otherwise, the expression is evaluated against the file and produces a boolean
result.  If that result is true then the file is considered a match and is
added to the output set.</p>

<p>An expression term is canonically represented as a JSON array whose zeroth
element is a string containing the term name.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="s2">"termname"</span><span class="p">,</span><span class="w"> </span><span class="err">arg</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">arg</span><span class="mi">2</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>If the term accepts no arguments you may use a short form that consists of just
the term name expressed as a string:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="s2">"true"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Expressions that match against file names may match against either the
<em>basename</em> or the <em>wholename</em> of the file.  The basename is the name of the
file within its containing directory.  The wholename is the name of the file
relative to the watched root.</p>

<p>You can find a list of all possible expression terms in the sidebar on the left
of this page.</p>

<h3 id="relative-roots">Relative roots</h3>

<p><em>Since 3.3.</em></p>

<p>Watchman supports optionally evaluating queries with respect to a path within a
watched root. This is used with the <code class="language-plaintext highlighter-rouge">relative_root</code> parameter:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="s2">"query"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/path/to/watched/root"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"relative_root"</span><span class="p">:</span><span class="w"> </span><span class="s2">"project1"</span><span class="p">,</span><span class="w">
</span><span class="p">}]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Setting a relative root results in the following modifications to queries:</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">path</code> generator is evaluated with respect to the relative root. In the
above example, <code class="language-plaintext highlighter-rouge">"path": ["dir"]</code> will return all files inside
<code class="language-plaintext highlighter-rouge">/path/to/watched/root/project1/dir</code>.</li>
  <li>The input expression is evaluated with respect to the relative root. In the
above example, <code class="language-plaintext highlighter-rouge">"expression": ["match", "dir/*.txt", "wholename"]</code> will return
all files inside <code class="language-plaintext highlighter-rouge">/path/to/watched/root/project1/dir/</code> that match the glob
<code class="language-plaintext highlighter-rouge">*.txt</code>.</li>
  <li>Paths inside the relative root are returned with the relative root stripped
off. For example, a path <code class="language-plaintext highlighter-rouge">project1/dir/file.txt</code> would be returned as
<code class="language-plaintext highlighter-rouge">dir/file.txt</code>.</li>
  <li>Paths outside the relative root are not returned.</li>
</ul>

<p>Relative roots behave similarly to a separate Watchman watch on the
subdirectory, without any of the system overhead that that imposes. This is
useful for large repositories, where your script or tool is only interested in a
particular directory inside the repository.</p>


    
  </article>
</div>

  </div>
</div>


      <div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <section id="fb_oss" class="fbOpenSourceFooter">
      <a href="https://code.facebook.com/projects/" target="_blank"><img src="/watchman/static/oss_logo.png" alt="Facebook Open Source" title="Facebook Open Source" /></a>
    </section>
  </div>
</div>
<script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = window.location.href.replace(window.location.hash, '') + "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  window.addEventListener('load', function() {
    var contentBlock = document.getElementsByClassName("post")[0] || document.getElementsByClassName("news")[0];
    if (!contentBlock) {
      return;
    }
    for (var level = 1; level <= 6; level++) {
      linkifyAnchors(level, contentBlock);
    }
  });
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44373548-13', 'auto');
  ga('send', 'pageview');
</script>
<script>
  window.addEventListener('load', function() {
    hljs.initHighlightingOnLoad();

    // Async load some styles
    function loadStyle(href) {
      var s = document.createElement('link');
      s.setAttribute('rel', 'stylesheet');
      s.setAttribute('href', href);
      s.setAttribute('type', 'text/css');
      document.getElementsByTagName('head')[0].appendChild(s);
    }
    loadStyle("//nuclide.io/static/fonts/332720/BC699FA675F9356E3.css");
    loadStyle("//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css");
    loadStyle("//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css");
  });
</script>

    </div>
  </body>

</html>
